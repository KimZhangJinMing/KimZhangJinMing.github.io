<!DOCTYPE html>





<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Slippers_32x32.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Slippers_16x16.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    save_scroll: false,
    copycode: {"enable":true,"show_result":true,"style":null},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>
<script>
    (function () {
        if ('') {
            if (prompt('请输入文章密码') !== '') {
                alert('密码错误！');
                if (history.length === 1) {
                    location.replace("http://xxxxxxx.xxx"); // 这里替换成你的首页地址
                } else {
                    history.back();
                }
            }
        }
    })();
</script>

  <meta name="description" content="1. Docker简介 1.1 基本概念 1.2 安装Docker 1.3 阿里云镜像加速器 1.4 docerk run 流程 1.5 底层原理   2.镜像的基本命令 2.1 查看版本 2.2 查看镜像 2.2 搜索镜像 2.3 下载镜像 2.4 删除镜像 2.5 导出镜像 2.6 导入镜像   3.容器的基本命令 3.1 创建容器并启动 3.2 查看容器 3.3 退出容器 3.4 删除容器">
<meta name="keywords" content="Java,SSM,大学生活">
<meta property="og:type" content="article">
<meta property="og:title" content="kim.zhang">
<meta property="og:url" content="http://www.zhang.kim/2021/11/21/Spring Cloud/Docker/index.html">
<meta property="og:site_name" content="kim.zhang">
<meta property="og:description" content="1. Docker简介 1.1 基本概念 1.2 安装Docker 1.3 阿里云镜像加速器 1.4 docerk run 流程 1.5 底层原理   2.镜像的基本命令 2.1 查看版本 2.2 查看镜像 2.2 搜索镜像 2.3 下载镜像 2.4 删除镜像 2.5 导出镜像 2.6 导入镜像   3.容器的基本命令 3.1 创建容器并启动 3.2 查看容器 3.3 退出容器 3.4 删除容器">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101205537190.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101213032540.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101214614552.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101213937951.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101225333094.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101225852498.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102132444427.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102132515791.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/12842279-f5d4c22882f4a649.png?imageMogr2/auto-orient/strip%7CimageView2/2/format/webp">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102143249340.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102154829545.png">
<meta property="og:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102193605035.png">
<meta property="og:updated_time" content="2021-12-31T12:48:36.115Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kim.zhang">
<meta name="twitter:description" content="1. Docker简介 1.1 基本概念 1.2 安装Docker 1.3 阿里云镜像加速器 1.4 docerk run 流程 1.5 底层原理   2.镜像的基本命令 2.1 查看版本 2.2 查看镜像 2.2 搜索镜像 2.3 下载镜像 2.4 删除镜像 2.5 导出镜像 2.6 导入镜像   3.容器的基本命令 3.1 创建容器并启动 3.2 查看容器 3.3 退出容器 3.4 删除容器">
<meta name="twitter:image" content="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101205537190.png">
  <link rel="canonical" href="http://www.zhang.kim/2021/11/21/Spring Cloud/Docker/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title> | kim.zhang</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-left">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">kim.zhang</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">风在前，无惧!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">42</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">12</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">94</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>


    </div>
</nav>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    
    <div class="reading-progress-bar"></div>

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhang.kim/2021/11/21/Spring Cloud/Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kim.Zhang">
      <meta itemprop="description" content="且行且珍惜">
      <meta itemprop="image" content="/images/1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kim.zhang">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">

            
          </h1>
        

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2021-11-21 12:56:33" itemprop="dateCreated datePublished" datetime="2021-11-21T12:56:33+08:00">2021-11-21</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-31 20:48:36" itemprop="dateModified" datetime="2021-12-31T20:48:36+08:00">2021-12-31</time>
              </span>
            
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>67k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>1:01</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <ul>
<li><a href="#1-docker简介">1. Docker简介</a><ul>
<li><a href="#11-基本概念">1.1 基本概念</a></li>
<li><a href="#12-安装docker">1.2 安装Docker</a></li>
<li><a href="#13-阿里云镜像加速器">1.3 阿里云镜像加速器</a></li>
<li><a href="#14-docerk-run-流程">1.4 docerk run 流程</a></li>
<li><a href="#15-底层原理">1.5 底层原理</a></li>
</ul>
</li>
<li><a href="#2镜像的基本命令">2.镜像的基本命令</a><ul>
<li><a href="#21-查看版本">2.1 查看版本</a></li>
<li><a href="#22-查看镜像">2.2 查看镜像</a></li>
<li><a href="#22-搜索镜像">2.2 搜索镜像</a></li>
<li><a href="#23-下载镜像">2.3 下载镜像</a></li>
<li><a href="#24-删除镜像">2.4 删除镜像</a></li>
<li><a href="#25-导出镜像">2.5 导出镜像</a></li>
<li><a href="#26-导入镜像">2.6 导入镜像</a></li>
</ul>
</li>
<li><a href="#3容器的基本命令">3.容器的基本命令</a><ul>
<li><a href="#31-创建容器并启动">3.1 创建容器并启动</a></li>
<li><a href="#32-查看容器">3.2 查看容器</a></li>
<li><a href="#33-退出容器">3.3 退出容器</a></li>
<li><a href="#34-删除容器">3.4 删除容器</a></li>
<li><a href="#35-启动和停止容器">3.5 启动和停止容器</a></li>
<li><a href="#36-查看容器日志">3.6 查看容器日志</a></li>
<li><a href="#37-导出容器">3.7 导出容器</a></li>
<li><a href="#38-导入容器">3.8 导入容器</a></li>
</ul>
</li>
<li><a href="#4常用其他命令">4.常用其他命令</a><ul>
<li><a href="#41-后台启动容器">4.1 后台启动容器</a></li>
<li><a href="#42-查看日志">4.2 查看日志</a></li>
<li><a href="#43-查看容器中进程的信息">4.3 查看容器中进程的信息</a></li>
<li><a href="#44-查看镜像的元数据">4.4 查看镜像的元数据</a></li>
<li><a href="#45-进入当前正在运行的容器">4.5 进入当前正在运行的容器</a></li>
<li><a href="#46-从容器内拷贝文件到主机上">4.6 从容器内拷贝文件到主机上</a></li>
</ul>
</li>
<li><a href="#5命令小结">5.命令小结</a></li>
<li><a href="#6-小实战">6. 小实战</a><ul>
<li><a href="#61-部署nginx">6.1 部署nginx</a></li>
<li><a href="#62-部署tomcat">6.2 部署tomcat</a></li>
</ul>
</li>
<li><a href="#7提交镜像">7.提交镜像</a></li>
<li><a href="#8容器数据卷">8.容器数据卷</a><ul>
<li><a href="#81-部署mysql">8.1 部署mysql</a></li>
<li><a href="#82-具名挂载和匿名挂载">8.2 具名挂载和匿名挂载</a></li>
<li><a href="#83-权限">8.3 权限</a></li>
<li><a href="#84-多个容器挂载同一个目录">8.4 多个容器挂载同一个目录</a></li>
<li><a href="#85-macos数据卷挂载目录">8.5 Macos数据卷挂载目录</a></li>
</ul>
</li>
<li><a href="#9dockfile">9.Dockfile</a><ul>
<li><a href="#91-制作dockefile">9.1 制作Dockefile</a></li>
<li><a href="#92-dockfile指令">9.2 Dockfile指令</a><ul>
<li><a href="#921-from">9.2.1 FROM</a></li>
<li><a href="#922-run">9.2.2 RUN</a></li>
<li><a href="#923-expose">9.2.3 EXPOSE</a></li>
<li><a href="#924-workdir">9.2.4 WORKDIR</a></li>
<li><a href="#925-copy">9.2.5 COPY</a></li>
<li><a href="#926-add">9.2.6 ADD</a></li>
<li><a href="#927-volume">9.2.7 VOLUME</a></li>
<li><a href="#928-emv">9.2.8 EMV</a></li>
<li><a href="#929-cmd">9.2.9 CMD</a></li>
<li><a href="#9210-entrypoint">9.2.10 ENTRYPOINT</a></li>
<li><a href="#9211-cmdentrypoint区别">9.2.11 CMD|ENTRYPOINT区别</a></li>
<li><a href="#9212-healthcheck">9.2.12 HEALTHCHECK</a></li>
<li><a href="#9213-user">9.2.13 USER</a></li>
</ul>
</li>
<li><a href="#93-查看构建过程">9.3 查看构建过程</a></li>
<li><a href="#94-制作tomcat的dockfile">9.4 制作tomcat的Dockfile</a></li>
<li><a href="#95-不同操作系统的镜像">9.5 不同操作系统的镜像</a><ul>
<li><a href="#951-查看manifest列表">9.5.1 查看manifest列表</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#10发布自己的镜像">10.发布自己的镜像</a></li>
<li><a href="#11-docker网络">11. Docker网络</a><ul>
<li><a href="#111-问题1宿主机和容器能不能ping通--">11.1 问题1：宿主机和容器能不能ping通？  ✔</a></li>
<li><a href="#112-问题2两个容器直接能否直接ping通-">11.2 问题2：两个容器直接能否直接ping通？ ✔</a></li>
<li><a href="#113-能否通过容器的name来连接---link-">11.3 能否通过容器的name来连接？ ×(–link ✔)</a></li>
<li><a href="#114-自定义网络">11.4 自定义网络</a></li>
<li><a href="#115-网络互联">11.5 网络互联</a></li>
<li><a href="#116-查看容器ip">11.6 查看容器IP</a><ul>
<li><a href="#1161-在容器内查看">11.6.1 在容器内查看</a></li>
<li><a href="#1162-在容器外查看">11.6.2 在容器外查看</a></li>
<li><a href="#1163-获取所有容器名称和ip">11.6.3 获取所有容器名称和IP</a></li>
</ul>
</li>
<li><a href="#117-macos的网络问题">11.7 Macos的网络问题</a></li>
<li><a href="#118-查看端口映射配置">11.8 查看端口映射配置</a></li>
</ul>
</li>
<li><a href="#12docker工具安装">12.Docker工具安装</a><ul>
<li><a href="#121-vim">12.1 vim</a></li>
<li><a href="#122-ping">12.2 ping</a></li>
<li><a href="#123-ifconfig">12.3 ifconfig</a></li>
<li><a href="#124-yum">12.4 yum</a></li>
</ul>
</li>
<li><a href="#13常用容器">13.常用容器</a><ul>
<li><a href="#131-mysql">13.1 Mysql</a></li>
<li><a href="#132-tomcat">13.2 tomcat</a></li>
</ul>
</li>
</ul>
<h3 id="1-Docker简介"><a href="#1-Docker简介" class="headerlink" title="1. Docker简介"></a>1. Docker简介</h3><p>Docker是一种虚拟化技术，类比于虚拟机。虚拟机的使用需要安装操作系统并在操作系统上安装软件才能使用。虚拟机上的软件需要消耗系统的资源的时候,由虚拟机的操作系统向宿主机的操作系统申请.而Docker是共用宿主机的内核,而且各个容器之间是操作系统级别隔离的,每个容器都只安装了最小的运行环境.<code>Dockre是比虚拟机更加轻量的虚拟技术。</code></p>
<p>Docker优势:<br>1.将应用程序和运行环境一起打包,保持一致的运行环境,轻松迁移<br>2.对进程进行封装隔离,容器与容器之间互不影响</p>
<h4 id="1-1-基本概念"><a href="#1-1-基本概念" class="headerlink" title="1.1 基本概念"></a>1.1 基本概念</h4><blockquote>
<p>镜像image</p>
</blockquote>
<p>Docker镜像就好比是一个软件安装包，通过这个镜像可以创建容器,一个镜像可以创建多个容器.</p>
<p>比如,一个tomcat镜像 -&gt; docker run -&gt; tomcat容器(提供服务)。<br>一个镜像可以创建多个tomcat容器,相当于通过一个软件包安装了多个tomcat,每个容器之间互不影响.</p>
<blockquote>
<p>容器Container</p>
</blockquote>
<p>Docker利用容器技术，独立运行一个或一组应用。</p>
<p>容器是通过镜像来创建的。</p>
<blockquote>
<p>仓库Repository</p>
</blockquote>
<p>仓库就是存放镜像的地方。分为公有仓库和私有仓库。</p>
<p>DockerHub(国外)，阿里云(国内，配置镜像加速)</p>
<h4 id="1-2-安装Docker"><a href="#1-2-安装Docker" class="headerlink" title="1.2 安装Docker"></a>1.2 安装Docker</h4><ol>
<li>查看环境</li>
</ol>
<p>查看Linux版本，系统内核要求3.10以上：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux ming 3.10.0-514.26.2.el7.x86_64 #1 SMP Tue Jul 4 15:04:05 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>

<p>查看系统信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/os-release</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">NAME="CentOS Linux"</span><br><span class="line">VERSION="7 (Core)"</span><br><span class="line">ID="centos"</span><br><span class="line">ID_LIKE="rhel fedora"</span><br><span class="line">VERSION_ID="7"</span><br><span class="line">PRETTY_NAME="CentOS Linux 7 (Core)"</span><br><span class="line">ANSI_COLOR="0;31"</span><br><span class="line">CPE_NAME="cpe:/o:centos:centos:7"</span><br><span class="line">HOME_URL="https://www.centos.org/"</span><br><span class="line">BUG_REPORT_URL="https://bugs.centos.org/"</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT="CentOS-7"</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION="7"</span><br><span class="line">REDHAT_SUPPORT_PRODUCT="centos"</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION="7"</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>安装Docker</li>
</ol>
<blockquote>
<p>如果已经安装过docker，卸载已经安装的版本</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<blockquote>
<p>设置Docker的仓库</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 下载yum-utils(其中包含了yum-config-manager)</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 设置阿里的docker仓库地址</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<blockquote>
<p>安装Docker</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 清除缓存</span></span><br><span class="line">yum makecache fast</span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载docker</span></span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看Docker版本信息</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p>出现以下结果，说明Docker安装成功。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           20.10.1</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.13.15</span><br><span class="line"> Git commit:        831ebea</span><br><span class="line"> Built:             Tue Dec 15 04:37:17 2020</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      true</span><br></pre></td></tr></table></figure>

<blockquote>
<p>启动docker</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<blockquote>
<p>运行hello-world示例镜像</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101205537190.png" alt="image-docker hello-world"></p>
<h4 id="1-3-阿里云镜像加速器"><a href="#1-3-阿里云镜像加速器" class="headerlink" title="1.3 阿里云镜像加速器"></a>1.3 阿里云镜像加速器</h4><p>登录阿里云，找到<code>容器镜像服务</code>，镜像加速器。</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101213032540.png" alt="image-阿里云镜像加速器"></p>
<h4 id="1-4-docerk-run-流程"><a href="#1-4-docerk-run-流程" class="headerlink" title="1.4 docerk run 流程"></a>1.4 docerk run 流程</h4><p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101214614552.png" alt="image-docker run运行流程"></p>
<h4 id="1-5-底层原理"><a href="#1-5-底层原理" class="headerlink" title="1.5 底层原理"></a>1.5 底层原理</h4><blockquote>
<p>Docker是怎么工作的？</p>
</blockquote>
<p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在服务器上，客户端通过Socket访问，</p>
<p>Docker Server接收到Docker Client的指令，就会执行这个命令。</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101213937951.png" alt="image-Docker工作原理"></p>
<h3 id="2-镜像的基本命令"><a href="#2-镜像的基本命令" class="headerlink" title="2.镜像的基本命令"></a>2.镜像的基本命令</h3><p><a href="https://docs.docker.com/engine/reference/commandline/docker/" target="_blank" rel="noopener">官方参考文档</a></p>
<h4 id="2-1-查看版本"><a href="#2-1-查看版本" class="headerlink" title="2.1 查看版本"></a>2.1 查看版本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 显示docker版本</span></span><br><span class="line">docker -v</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示docker客户端和服务器的详细版本</span></span><br><span class="line">docker version</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示docker的系统信息，包括镜像和容器的数量</span></span><br><span class="line">docker info</span><br><span class="line"><span class="meta">#</span><span class="bash"> 帮助命令</span></span><br><span class="line">docker 命令 --help</span><br></pre></td></tr></table></figure>

<h4 id="2-2-查看镜像"><a href="#2-2-查看镜像" class="headerlink" title="2.2 查看镜像"></a>2.2 查看镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 查看所有镜像</span></span><br><span class="line">docker images -a</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查看镜像的id</span></span><br><span class="line">docker images -q</span><br></pre></td></tr></table></figure>

<h4 id="2-2-搜索镜像"><a href="#2-2-搜索镜像" class="headerlink" title="2.2 搜索镜像"></a>2.2 搜索镜像</h4><p>搜索镜像可以使用DockerHub搜索，也可以使用命令进行搜索。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 搜索mysql的镜像</span></span><br><span class="line">docker search mysql</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 搜索stars大于9000的本版</span></span><br><span class="line">docker search mysql --filter=stars=9000</span><br></pre></td></tr></table></figure>

<h4 id="2-3-下载镜像"><a href="#2-3-下载镜像" class="headerlink" title="2.3 下载镜像"></a>2.3 下载镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 不指定版本，默认下载最新版本latest</span></span><br><span class="line">docker pull mysql</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 下载指定版本，这里的版本号一定要是DockerHub上有的版本</span></span><br><span class="line">docker pull mysql:5.7</span><br></pre></td></tr></table></figure>

<p>既然知道了真实地址，docker pull mysql:5.7 相当于 docker pull docker.io/library/mysql:5.7</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101225333094.png" alt="image-docker pull mysql:5.7"></p>
<h4 id="2-4-删除镜像"><a href="#2-4-删除镜像" class="headerlink" title="2.4 删除镜像"></a>2.4 删除镜像</h4><p>如果有容器使用了镜像,即使容器没有启动,删除镜像之前也需要将对应的容器删除.当然可以使用-f强制删除.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.通过镜像名称删除，-f 强制删除</span></span><br><span class="line">docker rmi -f mysql</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 通过id删除</span></span><br><span class="line">docker rmi -f f07dfa83b528</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 删除所有的镜像</span></span><br><span class="line">docker rmi -f $(docker images -aq)</span><br></pre></td></tr></table></figure>

<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210101225852498.png" alt="image-删除镜像"></p>
<h4 id="2-5-导出镜像"><a href="#2-5-导出镜像" class="headerlink" title="2.5 导出镜像"></a>2.5 导出镜像</h4><p>-o 指定输出文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@aliyun ~]# docker import tomcat.tar mytomcat:01</span><br><span class="line">sha256:528cde1da5e8e928b7c5415541371a6b6cdbc0c0a1aa05bba642e43ec9da4862</span><br></pre></td></tr></table></figure>

<h4 id="2-6-导入镜像"><a href="#2-6-导入镜像" class="headerlink" title="2.6 导入镜像"></a>2.6 导入镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@aliyun ~]# docker import tomcat.tar mytomcat:01</span><br><span class="line">sha256:528cde1da5e8e928b7c5415541371a6b6cdbc0c0a1aa05bba642e43ec9da4862</span><br></pre></td></tr></table></figure>

<h3 id="3-容器的基本命令"><a href="#3-容器的基本命令" class="headerlink" title="3.容器的基本命令"></a>3.容器的基本命令</h3><h4 id="3-1-创建容器并启动"><a href="#3-1-创建容器并启动" class="headerlink" title="3.1 创建容器并启动"></a>3.1 创建容器并启动</h4><p>有些容器在使用Dockerfile构建镜像的时候,Dockerfile中可能就已经存在了CMD指令.<br>比如以-it交互模式启动centos容器时,默认执行的CMD指令是 /bin/bash.<br>当然,可以在启动容器的时候覆盖默认的CMD指令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看centos:7镜像创建的过程,能发现默认的CMD指令是/bin/bash</span></span><br><span class="line">[root@aliyun ~]# docker history centos:7</span><br><span class="line">IMAGE          CREATED        CREATED BY                                      SIZE      COMMENT</span><br><span class="line">eeb6ee3f44bd   3 months ago   /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B        </span><br><span class="line">&lt;missing&gt;      3 months ago   /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B        </span><br><span class="line">&lt;missing&gt;      3 months ago   /bin/sh -c #(nop) ADD file:b3ebbe8bd304723d4…   204MB     </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在启动容器时覆盖默认的CMD指令,会执行cat /etc/os-release 查看版本信息</span></span><br><span class="line">[root@aliyun ~]# docker run -it centos:7 cat /etc/os-release</span><br><span class="line">NAME="CentOS Linux"</span><br><span class="line">VERSION="7 (Core)"</span><br><span class="line">ID="centos"</span><br><span class="line">ID_LIKE="rhel fedora"</span><br><span class="line">VERSION_ID="7"</span><br><span class="line">PRETTY_NAME="CentOS Linux 7 (Core)"</span><br><span class="line">ANSI_COLOR="0;31"</span><br><span class="line">CPE_NAME="cpe:/o:centos:centos:7"</span><br><span class="line">HOME_URL="https://www.centos.org/"</span><br><span class="line">BUG_REPORT_URL="https://bugs.centos.org/"</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT="CentOS-7"</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION="7"</span><br><span class="line">REDHAT_SUPPORT_PRODUCT="centos"</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION="7"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数解释</span></span><br><span class="line">--name=""  # 指定容器名字</span><br><span class="line">-d         # 后台方式运行</span><br><span class="line">-it        # 使用交互方式运行，进入容器查看内容</span><br><span class="line">-p         # 指定容器的端口，有以下几种形式</span><br><span class="line">	- 主机端口：容器端口（常用）</span><br><span class="line">	- ip:主机端口：容器端口</span><br><span class="line">	- 容器端口</span><br><span class="line">-P         # 随机指定端口</span><br></pre></td></tr></table></figure>

<p>进入容器后,主机名称变成了容器id.<br>如果在启动容器的时候没有通过–name指定容器的名称,Docker会自动生成一个随机的容器名称.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入容器后,主机名称变成了容器id</span></span><br><span class="line">[root@8434890d1132 /]# </span><br><span class="line"></span><br><span class="line">[root@ming local]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">41a27a712b32   centos    "/bin/bash"   14 seconds ago   Up 13 seconds             funny_wright</span><br></pre></td></tr></table></figure>

<h4 id="3-2-查看容器"><a href="#3-2-查看容器" class="headerlink" title="3.2 查看容器"></a>3.2 查看容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 查看正在运行的容器</span></span><br><span class="line">docker ps </span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查看正在运行的容器和历史运行的容器</span></span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数解释</span></span><br><span class="line">-n=1 # 显示最近创建的容器</span><br><span class="line">-q   # 只显示容器id</span><br></pre></td></tr></table></figure>

<h4 id="3-3-退出容器"><a href="#3-3-退出容器" class="headerlink" title="3.3 退出容器"></a>3.3 退出容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 退出容器并关闭</span></span><br><span class="line">[root@8434890d1132 /]# exit</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 退出容器，不关闭</span></span><br><span class="line">CTRL + P + Q</span><br></pre></td></tr></table></figure>

<h4 id="3-4-删除容器"><a href="#3-4-删除容器" class="headerlink" title="3.4 删除容器"></a>3.4 删除容器</h4><p>删除容器使用rm，删除镜像使用rmi。(i = image)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 指定容器id删除</span></span><br><span class="line">docker rm -f 41a27a712b32</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 删除所有容器，指定参数-f强制删除，如果容器正在运行，也能删除</span></span><br><span class="line">docker rm -f $(docker ps -aq)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 删除所有容器，如果容器正在运行，会报错</span></span><br><span class="line">docker ps -aq|xargs docker rm</span><br></pre></td></tr></table></figure>

<h4 id="3-5-启动和停止容器"><a href="#3-5-启动和停止容器" class="headerlink" title="3.5 启动和停止容器"></a>3.5 启动和停止容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 启动容器</span></span><br><span class="line">docker start 容器id</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 重启容器</span></span><br><span class="line">docker restart 容器id</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 停止容器</span></span><br><span class="line">docker stop 容器id</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 容器在运行，可以使用<span class="built_in">kill</span>强制停止容器</span></span><br><span class="line">docker kill 容器id</span><br></pre></td></tr></table></figure>

<h4 id="3-6-查看容器日志"><a href="#3-6-查看容器日志" class="headerlink" title="3.6 查看容器日志"></a>3.6 查看容器日志</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker logs 容器id</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -f 查看实时日志</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -t 显示宿主机的时间</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -n(--tail) 显示末尾的n行日志</span></span><br></pre></td></tr></table></figure>

<h4 id="3-7-导出容器"><a href="#3-7-导出容器" class="headerlink" title="3.7 导出容器"></a>3.7 导出容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@aliyun ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND             CREATED          STATUS          PORTS      NAMES</span><br><span class="line">47a5903b4f65   tomcat    "catalina.sh run"   27 seconds ago   Up 26 seconds   8080/tcp   tomcat</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将tomcat容器导出tomcat.tar包</span></span><br><span class="line">[root@aliyun ~]# docker export 47a &gt; tomcat.tar</span><br><span class="line">[root@aliyun ~]# ls -l</span><br><span class="line">total 667328</span><br><span class="line">drwxr-xr-x 3 root root      4096 Dec 25 15:17 dockfile</span><br><span class="line">-rw-r--r-- 1 root root 683334144 Dec 25 19:02 tomcat.tar</span><br></pre></td></tr></table></figure>

<h4 id="3-8-导入容器"><a href="#3-8-导入容器" class="headerlink" title="3.8 导入容器"></a>3.8 导入容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 第一种写法</span></span><br><span class="line">[root@aliyun ~]# cat tomcat.tar | docker import - mytomcat:01</span><br><span class="line">sha256:05c233b97f2fee4fb74846f74dcb72a98e5cb2ec454db1e3dcbd3aacb318ebff</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第二种写法</span></span><br><span class="line">[root@aliyun ~]# docker import tomcat.tar mytomcat:01</span><br><span class="line">sha256:528cde1da5e8e928b7c5415541371a6b6cdbc0c0a1aa05bba642e43ec9da4862</span><br></pre></td></tr></table></figure>

<p>用户既可以使用 docker load 来导入镜像存储文件到本地镜像库,也可以使用 docker import 来导入一个容器快照到本地镜像库.<br>这两者的区别在于容器快照文件将丢弃所有的历史记录和元数据信息(即仅保存容器当时的快照状态),而镜像存储文件将保存完整记录,体积也要大.<br>此外,从容器快照文件导入时可以重新指定标签等元数据信息</p>
<h3 id="4-常用其他命令"><a href="#4-常用其他命令" class="headerlink" title="4.常用其他命令"></a>4.常用其他命令</h3><h4 id="4-1-后台启动容器"><a href="#4-1-后台启动容器" class="headerlink" title="4.1 后台启动容器"></a>4.1 后台启动容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d 镜像名称</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 问题：后台方式启动容器后,docker ps查看容器,发现刚启动的容器停止了?</span></span><br><span class="line">docker容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会自动停止.</span><br></pre></td></tr></table></figure>

<h4 id="4-2-查看日志"><a href="#4-2-查看日志" class="headerlink" title="4.2 查看日志"></a>4.2 查看日志</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看容器7194f420dccf最近10行的日志信息</span></span><br><span class="line">docker logs -tf --tail 10 7194f420dccf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数解释</span></span><br><span class="line">-f # 显示最新的日志</span><br><span class="line">-t # 显示时间戳</span><br><span class="line">-tail n # 显示最后n行</span><br></pre></td></tr></table></figure>

<p>为了方便查看日志，启动容器的时候让它运行脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 后台方式启动，每隔1s输出hello,world，方便查看日志信息</span></span><br><span class="line">docker run -d centos /bin/sh -c "while true;do echo hello,world;sleep 1;done"</span><br><span class="line"></span><br><span class="line">[root@ming local]# docker logs -tf --tail 10 7194f420dccf </span><br><span class="line">2021-01-02T04:59:49.064172640Z hello,world</span><br><span class="line">2021-01-02T04:59:50.065917036Z hello,world</span><br><span class="line">2021-01-02T04:59:51.067497230Z hello,world</span><br><span class="line">2021-01-02T04:59:52.069279085Z hello,world</span><br><span class="line">2021-01-02T04:59:53.070906928Z hello,world</span><br><span class="line">2021-01-02T04:59:54.072698176Z hello,world</span><br><span class="line">2021-01-02T04:59:55.074312881Z hello,world</span><br><span class="line">2021-01-02T04:59:56.075940314Z hello,world</span><br><span class="line">2021-01-02T04:59:57.077579824Z hello,world</span><br><span class="line">2021-01-02T04:59:58.083724580Z hello,world</span><br><span class="line">2021-01-02T04:59:59.085284061Z hello,world</span><br><span class="line">2021-01-02T05:00:00.086883423Z hello,world</span><br><span class="line">2021-01-02T05:00:01.088530900Z hello,world</span><br></pre></td></tr></table></figure>

<h4 id="4-3-查看容器中进程的信息"><a href="#4-3-查看容器中进程的信息" class="headerlink" title="4.3 查看容器中进程的信息"></a>4.3 查看容器中进程的信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 查看容器中进程信息</span></span><br><span class="line">docker top 7194f420dccf</span><br></pre></td></tr></table></figure>

<h4 id="4-4-查看镜像的元数据"><a href="#4-4-查看镜像的元数据" class="headerlink" title="4.4 查看镜像的元数据"></a>4.4 查看镜像的元数据</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器id</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;	</span><br><span class="line">        # 容器的完整id，默认只是截取前面几位</span><br><span class="line">        "Id": "7194f420dccf83fc219103ba4b8fe704583cbe52a8e0ad53bc5ee7c788ece631",</span><br><span class="line">        "Created": "2021-01-02T04:54:22.996950933Z", # 容器创建时间</span><br><span class="line">        "Path": "/bin/sh",</span><br><span class="line">        "Args": [ # 启动容器时使用的参数</span><br><span class="line">            "-c",</span><br><span class="line">            <span class="string">"while true;do echo hello,world;sleep 1;done"</span></span><br><span class="line">        ],</span><br><span class="line">        "State": &#123; # 容器状态</span><br><span class="line">            "Status": "running",</span><br><span class="line">            "Running": true,</span><br><span class="line">            "Paused": false,</span><br><span class="line">            "Restarting": false,</span><br><span class="line">            "OOMKilled": false,</span><br><span class="line">            "Dead": false,</span><br><span class="line">            "Pid": 19341,</span><br><span class="line">            "ExitCode": 0,</span><br><span class="line">            "Error": "",</span><br><span class="line">            "StartedAt": "2021-01-02T04:54:23.420056968Z",</span><br><span class="line">            "FinishedAt": "0001-01-01T00:00:00Z"</span><br><span class="line">        &#125;,</span><br><span class="line">        "Image": "sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55", # 镜像信息</span><br><span class="line">        "ResolvConfPath": "/var/lib/docker/containers/7194f420dccf83fc219103ba4b8fe704583cbe52a8e0ad53bc5ee7c788ece631/resolv.conf",</span><br><span class="line">        "HostnamePath": "/var/lib/docker/containers/7194f420dccf83fc219103ba4b8fe704583cbe52a8e0ad53bc5ee7c788ece631/hostname",</span><br><span class="line">        "HostsPath": "/var/lib/docker/containers/7194f420dccf83fc219103ba4b8fe704583cbe52a8e0ad53bc5ee7c788ece631/hosts",</span><br><span class="line">        "LogPath": "/var/lib/docker/containers/7194f420dccf83fc219103ba4b8fe704583cbe52a8e0ad53bc5ee7c788ece631/7194f420dccf83fc219103ba4b8fe704583cbe52a8e0ad53bc5ee7c788ece631-json.log",</span><br><span class="line">        "Name": "/quizzical_brown",</span><br><span class="line">        "RestartCount": 0,</span><br><span class="line">        "Driver": "overlay2",</span><br><span class="line">        "Platform": "linux",</span><br><span class="line">        "MountLabel": "",</span><br><span class="line">        "ProcessLabel": "",</span><br><span class="line">        "AppArmorProfile": "",</span><br><span class="line">        "ExecIDs": null,</span><br><span class="line">        "HostConfig": &#123;</span><br><span class="line">            "Binds": null,</span><br><span class="line">            "ContainerIDFile": "",</span><br><span class="line">            "LogConfig": &#123;</span><br><span class="line">                "Type": "json-file",</span><br><span class="line">                "Config": &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            "NetworkMode": "default",</span><br><span class="line">            "PortBindings": &#123;&#125;,</span><br><span class="line">            "RestartPolicy": &#123;</span><br><span class="line">                "Name": "no",</span><br><span class="line">                "MaximumRetryCount": 0</span><br><span class="line">            &#125;,</span><br><span class="line">            "AutoRemove": false,</span><br><span class="line">            "VolumeDriver": "",</span><br><span class="line">            "VolumesFrom": null,</span><br><span class="line">            "CapAdd": null,</span><br><span class="line">            "CapDrop": null,</span><br><span class="line">            "CgroupnsMode": "host",</span><br><span class="line">            "Dns": [],</span><br><span class="line">            "DnsOptions": [],</span><br><span class="line">            "DnsSearch": [],</span><br><span class="line">            "ExtraHosts": null,</span><br><span class="line">            "GroupAdd": null,</span><br><span class="line">            "IpcMode": "private",</span><br><span class="line">            "Cgroup": "",</span><br><span class="line">            "Links": null,</span><br><span class="line">            "OomScoreAdj": 0,</span><br><span class="line">            "PidMode": "",</span><br><span class="line">            "Privileged": false,</span><br><span class="line">            "PublishAllPorts": false,</span><br><span class="line">            "ReadonlyRootfs": false,</span><br><span class="line">            "SecurityOpt": null,</span><br><span class="line">            "UTSMode": "",</span><br><span class="line">            "UsernsMode": "",</span><br><span class="line">            "ShmSize": 67108864,</span><br><span class="line">            "Runtime": "runc",</span><br><span class="line">            "ConsoleSize": [</span><br><span class="line">                0,</span><br><span class="line">                <span class="number">0</span></span><br><span class="line">            ],</span><br><span class="line">            "Isolation": "",</span><br><span class="line">            "CpuShares": 0,</span><br><span class="line">            "Memory": 0,</span><br><span class="line">            "NanoCpus": 0,</span><br><span class="line">            "CgroupParent": "",</span><br><span class="line">            "BlkioWeight": 0,</span><br><span class="line">            "BlkioWeightDevice": [],</span><br><span class="line">            "BlkioDeviceReadBps": null,</span><br><span class="line">            "BlkioDeviceWriteBps": null,</span><br><span class="line">            "BlkioDeviceReadIOps": null,</span><br><span class="line">            "BlkioDeviceWriteIOps": null,</span><br><span class="line">            "CpuPeriod": 0,</span><br><span class="line">            "CpuQuota": 0,</span><br><span class="line">            "CpuRealtimePeriod": 0,</span><br><span class="line">            "CpuRealtimeRuntime": 0,</span><br><span class="line">            "CpusetCpus": "",</span><br><span class="line">            "CpusetMems": "",</span><br><span class="line">            "Devices": [],</span><br><span class="line">            "DeviceCgroupRules": null,</span><br><span class="line">            "DeviceRequests": null,</span><br><span class="line">            "KernelMemory": 0,</span><br><span class="line">            "KernelMemoryTCP": 0,</span><br><span class="line">            "MemoryReservation": 0,</span><br><span class="line">            "MemorySwap": 0,</span><br><span class="line">            "MemorySwappiness": null,</span><br><span class="line">            "OomKillDisable": false,</span><br><span class="line">            "PidsLimit": null,</span><br><span class="line">            "Ulimits": null,</span><br><span class="line">            "CpuCount": 0,</span><br><span class="line">            "CpuPercent": 0,</span><br><span class="line">            "IOMaximumIOps": 0,</span><br><span class="line">            "IOMaximumBandwidth": 0,</span><br><span class="line">            "MaskedPaths": [</span><br><span class="line">                "/proc/asound",</span><br><span class="line">                "/proc/acpi",</span><br><span class="line">                "/proc/kcore",</span><br><span class="line">                "/proc/keys",</span><br><span class="line">                "/proc/latency_stats",</span><br><span class="line">                "/proc/timer_list",</span><br><span class="line">                "/proc/timer_stats",</span><br><span class="line">                "/proc/sched_debug",</span><br><span class="line">                "/proc/scsi",</span><br><span class="line">                <span class="string">"/sys/firmware"</span></span><br><span class="line">            ],</span><br><span class="line">            "ReadonlyPaths": [</span><br><span class="line">                "/proc/bus",</span><br><span class="line">                "/proc/fs",</span><br><span class="line">                "/proc/irq",</span><br><span class="line">                "/proc/sys",</span><br><span class="line">                <span class="string">"/proc/sysrq-trigger"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "GraphDriver": &#123;</span><br><span class="line">            "Data": &#123;</span><br><span class="line">                "LowerDir": "/var/lib/docker/overlay2/d76624dcc42355cece3b8a39ba99dcf0b1714c80f5c28fc7ff80cf778a635932-init/diff:/var/lib/docker/overlay2/d5c1df794c28e4c26a5118b7df6f110d8cd67fd4b2184e3f0509513bde2686ac/diff",</span><br><span class="line">                "MergedDir": "/var/lib/docker/overlay2/d76624dcc42355cece3b8a39ba99dcf0b1714c80f5c28fc7ff80cf778a635932/merged",</span><br><span class="line">                "UpperDir": "/var/lib/docker/overlay2/d76624dcc42355cece3b8a39ba99dcf0b1714c80f5c28fc7ff80cf778a635932/diff",</span><br><span class="line">                "WorkDir": "/var/lib/docker/overlay2/d76624dcc42355cece3b8a39ba99dcf0b1714c80f5c28fc7ff80cf778a635932/work"</span><br><span class="line">            &#125;,</span><br><span class="line">            "Name": "overlay2"</span><br><span class="line">        &#125;,</span><br><span class="line">        "Mounts": [],</span><br><span class="line">        "Config": &#123;</span><br><span class="line">            "Hostname": "7194f420dccf",</span><br><span class="line">            "Domainname": "",</span><br><span class="line">            "User": "",</span><br><span class="line">            "AttachStdin": false,</span><br><span class="line">            "AttachStdout": false,</span><br><span class="line">            "AttachStderr": false,</span><br><span class="line">            "Tty": false,</span><br><span class="line">            "OpenStdin": false,</span><br><span class="line">            "StdinOnce": false,</span><br><span class="line">            "Env": [</span><br><span class="line">                <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">            ],</span><br><span class="line">            "Cmd": [</span><br><span class="line">                "/bin/sh",</span><br><span class="line">                "-c",</span><br><span class="line">                <span class="string">"while true;do echo hello,world;sleep 1;done"</span></span><br><span class="line">            ],</span><br><span class="line">            "Image": "centos",</span><br><span class="line">            "Volumes": null,</span><br><span class="line">            "WorkingDir": "",</span><br><span class="line">            "Entrypoint": null,</span><br><span class="line">            "OnBuild": null,</span><br><span class="line">            "Labels": &#123;</span><br><span class="line">                "org.label-schema.build-date": "20201204",</span><br><span class="line">                "org.label-schema.license": "GPLv2",</span><br><span class="line">                "org.label-schema.name": "CentOS Base Image",</span><br><span class="line">                "org.label-schema.schema-version": "1.0",</span><br><span class="line">                "org.label-schema.vendor": "CentOS"</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "NetworkSettings": &#123;</span><br><span class="line">            "Bridge": "",</span><br><span class="line">            "SandboxID": "ea030739e7cabd90101a0040969de447c6ba176267e502f5a5558b19f2a4d813",</span><br><span class="line">            "HairpinMode": false,</span><br><span class="line">            "LinkLocalIPv6Address": "",</span><br><span class="line">            "LinkLocalIPv6PrefixLen": 0,</span><br><span class="line">            "Ports": &#123;&#125;,</span><br><span class="line">            "SandboxKey": "/var/run/docker/netns/ea030739e7ca",</span><br><span class="line">            "SecondaryIPAddresses": null,</span><br><span class="line">            "SecondaryIPv6Addresses": null,</span><br><span class="line">            "EndpointID": "2cef83333f52c17f883782c62909d4878761bb98238aa45939039609e2d1ccfc",</span><br><span class="line">            "Gateway": "172.17.0.1",</span><br><span class="line">            "GlobalIPv6Address": "",</span><br><span class="line">            "GlobalIPv6PrefixLen": 0,</span><br><span class="line">            "IPAddress": "172.17.0.2",</span><br><span class="line">            "IPPrefixLen": 16,</span><br><span class="line">            "IPv6Gateway": "",</span><br><span class="line">            "MacAddress": "02:42:ac:11:00:02",</span><br><span class="line">            "Networks": &#123;</span><br><span class="line">                "bridge": &#123;</span><br><span class="line">                    "IPAMConfig": null,</span><br><span class="line">                    "Links": null,</span><br><span class="line">                    "Aliases": null,</span><br><span class="line">                    "NetworkID": "1cd4dcbb6871cbcce8292729579d2a62dee582c9b7cd3810298c1d69bc1de4cb",</span><br><span class="line">                    "EndpointID": "2cef83333f52c17f883782c62909d4878761bb98238aa45939039609e2d1ccfc",</span><br><span class="line">                    "Gateway": "172.17.0.1",</span><br><span class="line">                    "IPAddress": "172.17.0.2",</span><br><span class="line">                    "IPPrefixLen": 16,</span><br><span class="line">                    "IPv6Gateway": "",</span><br><span class="line">                    "GlobalIPv6Address": "",</span><br><span class="line">                    "GlobalIPv6PrefixLen": 0,</span><br><span class="line">                    "MacAddress": "02:42:ac:11:00:02",</span><br><span class="line">                    "DriverOpts": null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="4-5-进入当前正在运行的容器"><a href="#4-5-进入当前正在运行的容器" class="headerlink" title="4.5 进入当前正在运行的容器"></a>4.5 进入当前正在运行的容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 进入当前正在运行的容器进行操作，不会启动新的进程</span></span><br><span class="line">docker attach 4db8b5f683c1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 进入当前正在运行的容器进行操作，会重新启动一个进程</span></span><br><span class="line">docker exec -it 4db8b5f683c1 /bin/bash</span><br></pre></td></tr></table></figure>

<p>虽然是不同的进程进行操作，但容器内的资源还是共享的。</p>
<p>首先使用docker exec -it 4db8b5f683c1 /bin/bash进入容器：</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102132444427.png" alt="image-docker attach"></p>
<p>然后使用docker attach 4db8b5f683c1进入容器:并没有启动一个新的/bin/bash进程。</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102132515791.png" alt="image-docker exec"></p>
<h4 id="4-6-从容器内拷贝文件到主机上"><a href="#4-6-从容器内拷贝文件到主机上" class="headerlink" title="4.6 从容器内拷贝文件到主机上"></a>4.6 从容器内拷贝文件到主机上</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 即使容器当前不在运行，也可以拷贝出文件</span></span><br><span class="line">docker cp 容器id:容器内路径  当前主机路径</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ming local]# docker cp 4db8b5f683c1:/aaa.txt /home/  # 将容器内/aaa.txt 拷贝到当前主机 /home/ 目录下</span><br><span class="line">[root@ming local]# ls /home</span><br><span class="line">aaa.txt</span><br></pre></td></tr></table></figure>

<h3 id="5-命令小结"><a href="#5-命令小结" class="headerlink" title="5.命令小结"></a>5.命令小结</h3><p><img src="https://upload-images.jianshu.io/upload_images/12842279-f5d4c22882f4a649.png?imageMogr2/auto-orient/strip%7CimageView2/2/format/webp" alt="docker命令图谱"></p>
<h3 id="6-小实战"><a href="#6-小实战" class="headerlink" title="6. 小实战"></a>6. 小实战</h3><h4 id="6-1-部署nginx"><a href="#6-1-部署nginx" class="headerlink" title="6.1 部署nginx"></a>6.1 部署nginx</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 下载nginx</span></span><br><span class="line">docker pull nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查看镜像</span></span><br><span class="line">[root@ming ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">nginx        latest    ae2feff98a0c   2 weeks ago   133MB</span><br><span class="line">centos       latest    300e315adb2f   3 weeks ago   209MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 启动容器，将主机的3344端口映射到容器内的80端口</span></span><br><span class="line">[root@ming ~]# docker run -p 3344:80 -it nginx  /bin/bash</span><br><span class="line">root@6b29c7751037:/# </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.查看nginx安装目录，版本信息</span></span><br><span class="line">root@6b29c7751037:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@6b29c7751037:/# cd /usr/sbin</span><br><span class="line">root@6b29c7751037:/usr/sbin# ./nginx -version</span><br><span class="line">nginx version: nginx/1.19.6</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5.启动nginx</span></span><br><span class="line">root@6b29c7751037:/usr/sbin# ./nginx</span><br></pre></td></tr></table></figure>

<p>外网访问<a href>http://47.96.224.198:3344/</a>，容器内启动nginx成功。</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102143249340.png" alt="image-docker部署nginx"></p>
<h4 id="6-2-部署tomcat"><a href="#6-2-部署tomcat" class="headerlink" title="6.2 部署tomcat"></a>6.2 部署tomcat</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 查看镜像</span></span><br><span class="line">[root@ming ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">tomcat       latest    feba8d001e3f   2 weeks ago   649MB</span><br><span class="line">nginx        latest    ae2feff98a0c   2 weeks ago   133MB</span><br><span class="line">centos       latest    300e315adb2f   3 weeks ago   209MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 启动容器，将主机的3355端口映射到容器内的80端口</span></span><br><span class="line">[root@ming ~]# docker run -p 3355:8080 -it tomcat /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 启动tomcat</span></span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat/bin# ./startup.sh </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 查看进程，tomcat已经启动</span></span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat/bin# ps -ef|grep tomcat</span><br><span class="line">root        15     1  1 07:45 pts/0    00:00:02 /usr/local/openjdk-11/bin/java -Djava.util.logging.config.file=/usr/local/tomcat/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Dorg.apache.catalina.security.SecurityListener.UMASK=0027 -Dignore.endorsed.dirs= -classpath /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar -Dcatalina.base=/usr/local/tomcat -Dcatalina.home=/usr/local/tomcat -Djava.io.tmpdir=/usr/local/tomcat/temp org.apache.catalina.startup.Bootstrap start</span><br><span class="line">root        45     1  0 07:47 pts/0    00:00:00 grep tomcat</span><br></pre></td></tr></table></figure>

<p>外网访问<a href>http://47.96.224.198:3355/</a>,出现以下界面：</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102154829545.png" alt="image-访问tomcat"></p>
<p>这是因为阿里云镜像默认是下载最小的镜像，只下载了必要的组件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# ls  </span><br><span class="line">BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist</span><br><span class="line">CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# ls webapps  # webapps目录是空的</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# ls webapps.dist/   # webapps.dist目录才是原本的webapps目录</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# mv webapps webapps.backup</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# mv webapps.dist webapps  # 将webapps.dist目录改成webapps目录</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# ls</span><br><span class="line">BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.backup</span><br><span class="line">CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work</span><br><span class="line">root@5e2e3cb50a29:/usr/local/tomcat# ls webapps</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br></pre></td></tr></table></figure>

<p>再次访问[<a href>http://47.96.224.198:3355/</a>,这次就可以正常访问了。</p>
<p><img src="https://jinming8.oss-cn-shenzhen.aliyuncs.com/img/image-20210102193605035.png" alt="image-访问docker中的tomcat"></p>
<h3 id="7-提交镜像"><a href="#7-提交镜像" class="headerlink" title="7.提交镜像"></a>7.提交镜像</h3><p>从仓库下载下来的镜像都是只读的，每当我们操作镜像，就会在原来镜像的上面加一层我们自己的操作，我们可以将它保存起来，下次直接使用我们操作过的镜像。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 查看镜像</span></span><br><span class="line">[root@ming /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED       STATUS       PORTS                    NAMES</span><br><span class="line">89b24a4b7084   tomcat    "/bin/bash"   4 hours ago   Up 4 hours   0.0.0.0:3366-&gt;8080/tcp   infallible_lewin</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 将我们操作过的镜像commit成mytomcat</span></span><br><span class="line">[root@ming /]# docker commit -m 'tomcat add webapps' -a 'xiaoming' 89b24a4b7084 mytomcat</span><br><span class="line">sha256:42d7b6dea11ce283033c6015765bff176ffbdad71105c02048e4e7352a5239f4</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 查看镜像</span></span><br><span class="line">[root@ming /]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">mytomcat     latest    42d7b6dea11c   10 seconds ago   654MB  # 我们自己生成的镜像</span><br><span class="line">tomcat       latest    feba8d001e3f   2 weeks ago      649MB</span><br><span class="line">nginx        latest    ae2feff98a0c   2 weeks ago      133MB</span><br><span class="line">centos       latest    300e315adb2f   3 weeks ago      209MB</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将镜像89b24a4b7084提交，生成我们自己的镜像mytomcat</span></span><br><span class="line">docker commit -m 'tomcat add webapps' -a 'xiaoming' 89b24a4b7084 mytomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数解释</span></span><br><span class="line">-m  # 提交的信息,类似于git commit</span><br><span class="line">-a  # 作者</span><br></pre></td></tr></table></figure>

<h3 id="8-容器数据卷"><a href="#8-容器数据卷" class="headerlink" title="8.容器数据卷"></a>8.容器数据卷</h3><p>我们在容器内操作，数据保存在容器内，这是一件很<code>危险</code>的事情，假如不小心删除了容器，容器内的数据就全部丢失了。</p>
<p>有没有一种技术可以将容器内的数据同步到宿主机器上，将容器内的目录和宿主机的目录进行绑定，无论修改容器内的目录，还是修改宿主机的目录，都能自动同步数据，完成数据的持久化呢？ 这就是数据卷的技术。</p>
<p>使用以下命令完成数据卷的挂载：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v 宿主机的目录:容器内的目录</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 进入容器，进行目录挂载</span></span><br><span class="line">docker run -p 3355:8080 -v /home/test/:/home -it mytomcat /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查看镜像状态，查看挂载信息</span></span><br><span class="line">docker inspect 7feb5a932a8b</span><br><span class="line">"Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "bind",</span><br><span class="line">                "Source": "/home/test",</span><br><span class="line">                "Destination": "/home",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": "rprivate"</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 进入到容器内,/home目录下创建文件test.java</span></span><br><span class="line">root@7feb5a932a8b:/home# ls</span><br><span class="line">test.java</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 查看宿主机器/home/<span class="built_in">test</span>目录下是否同步了test.java文件</span></span><br><span class="line">[root@ming test]# pwd</span><br><span class="line">/home/test</span><br><span class="line">[root@ming test]# ls</span><br><span class="line">test.java</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5.在宿主机上修改test.java文件，修改其内容</span></span><br><span class="line">[root@ming test]# vim test.java </span><br><span class="line">[root@ming test]# cat test.java </span><br><span class="line">hello,world</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6.查看容器中/home目录下的test.java文件</span></span><br><span class="line">root@7feb5a932a8b:/home# cat test.java </span><br><span class="line">hello,world</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论：使用数据卷技术，可以将容器内的目录和宿主机器上的目录进行同步，从而达到数据持久化的目的。</span></span><br></pre></td></tr></table></figure>

<h4 id="8-1-部署mysql"><a href="#8-1-部署mysql" class="headerlink" title="8.1 部署mysql"></a>8.1 部署mysql</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 直接使用docker run 下载mysql，如果本地不存在mysql的镜像，会从远程仓库中拉取</span></span><br><span class="line">docker run -p 3307:3306 -v /home/mysql/data:/var/lib/mysql -v /home/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456 --name mysql5.7 mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数解释</span></span><br><span class="line">-e  # 设置环境</span><br><span class="line">MYSQL_ROOT_PASSWORD # mysql root用户的密码</span><br><span class="line">--name  # 容器的名称</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.使用navicat连接数据库，并创建数据库<span class="built_in">test</span></span></span><br><span class="line">host:47.96.224.198:3307 </span><br><span class="line">username:root</span><br><span class="line">password:123456</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 查看宿主机上/home/mysql/data目录下有没有<span class="built_in">test</span>数据库</span></span><br><span class="line">[root@ming data]# pwd</span><br><span class="line">/home/mysql/data</span><br><span class="line">[root@ming data]# ll |grep test</span><br><span class="line">drwxr-x--- 2 systemd-bus-proxy input     4096 Jan  2 20:14 test  # test数据库,说明容器内的目录和宿主机的目录已经同步</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 删除容器</span></span><br><span class="line">docker rm -f a312a3e56f40 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5.数据持久化了，即使删除容器，数据也不会丢失</span></span><br><span class="line">[root@ming data]# ll | grep test</span><br><span class="line">drwxr-x--- 2 systemd-bus-proxy input     4096 Jan  2 20:14 test</span><br></pre></td></tr></table></figure>

<h4 id="8-2-具名挂载和匿名挂载"><a href="#8-2-具名挂载和匿名挂载" class="headerlink" title="8.2 具名挂载和匿名挂载"></a>8.2 具名挂载和匿名挂载</h4><p>之前使用的<code>docker run -v 宿主机的目录:容器内的目录</code>是指定目录的挂载方式。</p>
<p>除此之外，还有具名挂载和匿名挂载。</p>
<blockquote>
<p>具名挂载</p>
</blockquote>
<p>具名挂载通过<code>docker run -v 卷名：容器内的目录</code>进行挂载。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 具名挂载的方式启动nginx</span></span><br><span class="line">docker run -d -p 3344:80 -v juming_nginx:/etc/nginx nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查看数据卷</span></span><br><span class="line">[root@ming /]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     juming_nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 查看juming_nginx的详细信息</span></span><br><span class="line">[root@ming /]# docker volume inspect juming_nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "CreatedAt": "2021-01-02T20:37:12+08:00",</span><br><span class="line">        "Driver": "local",</span><br><span class="line">        "Labels": null,</span><br><span class="line">        "Mountpoint": "/var/lib/docker/volumes/juming_nginx/_data",  # 挂载的路径</span><br><span class="line">        "Name": "juming_nginx",</span><br><span class="line">        "Options": null,</span><br><span class="line">        "Scope": "local"</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 到挂载的路径下查看，nginx的配置文件目录已经挂载到了/var/lib/docker/volumes/juming_nginx/_data目录下</span></span><br><span class="line">[root@ming _data]# pwd</span><br><span class="line">/var/lib/docker/volumes/juming_nginx/_data</span><br><span class="line">[root@ming _data]# ls</span><br><span class="line">conf.d          koi-utf  mime.types  nginx.conf   uwsgi_params</span><br><span class="line">fastcgi_params  koi-win  modules     scgi_params  win-utf</span><br></pre></td></tr></table></figure>

<blockquote>
<p>匿名挂载</p>
</blockquote>
<p>匿名挂载通过<code>docker run -v 容器内路径</code>进行挂载。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 匿名挂载的方式启动nginx</span></span><br><span class="line">docker run -d -p 3344:80 -v /etc/nginx.conf nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查看数据卷,是一串字符串</span></span><br><span class="line">[root@ming _data]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     ffb564010a743ee8d607d1fd35bdf54fbef705881cf9c2625c431e83f626c532</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 查看挂载的详细信息</span></span><br><span class="line">[root@ming _data]# docker volume inspect ffb564010a743ee8d607d1fd35bdf54fbef705881cf9c2625c431e83f626c532</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "CreatedAt": "2021-01-02T20:42:50+08:00",</span><br><span class="line">        "Driver": "local",</span><br><span class="line">        "Labels": null,</span><br><span class="line">        "Mountpoint": "/var/lib/docker/volumes/ffb564010a743ee8d607d1fd35bdf54fbef705881cf9c2625c431e83f626c532/_data",  # 挂载的目录</span><br><span class="line">        "Name": "ffb564010a743ee8d607d1fd35bdf54fbef705881cf9c2625c431e83f626c532",</span><br><span class="line">        "Options": null,</span><br><span class="line">        "Scope": "local"</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.到挂载的目录查看，发现目录是空的</span></span><br><span class="line">[root@ming _data]# pwd</span><br><span class="line">/var/lib/docker/volumes/2909b1711dfe40c72036dc8d950d2da653a6b88563acbb0b1e49932469e1247d/_data</span><br><span class="line">[root@ming _data]# ls</span><br></pre></td></tr></table></figure>

<p>我们发现，如果不是以指定目录的方式进行挂载，挂载的目录默认是在<code>/var/lib/docker/volumes/卷名/_data/</code>目录下。</p>
<h4 id="8-3-权限"><a href="#8-3-权限" class="headerlink" title="8.3 权限"></a>8.3 权限</h4><p>相对于容器内而言，默认情况下，文件是可读可写的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 启动nginx容器并进入容器</span></span><br><span class="line">docker run -p 3344:80 -v juming_nginx:/etc/nginx.conf -it nginx /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 到/etc/目录下，查看nginx.conf的权限</span></span><br><span class="line">drwxr-xr-x 3 root root    4096 Jan  2 12:37 nginx.conf  # 可读可写的权限</span><br></pre></td></tr></table></figure>

<p>我们可以在启动容器的时候，指定容器内的文件权限：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. ro = <span class="built_in">read</span> only ,在容器内只读，不能修改</span></span><br><span class="line">docker run -p 3344:80 -v juming_nginx:/etc/nginx.conf:ro -it nginx /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. rw = <span class="built_in">read</span> write,在容器内可读，可写</span></span><br><span class="line">docker run -p 3344:80 -v juming_nginx:/etc/nginx.conf:ro -it nginx /bin/bash</span><br></pre></td></tr></table></figure>



<h4 id="8-4-多个容器挂载同一个目录"><a href="#8-4-多个容器挂载同一个目录" class="headerlink" title="8.4 多个容器挂载同一个目录"></a>8.4 多个容器挂载同一个目录</h4><p>使用–volume-for指定一个容器，同步这个容器的数据。就相当于，继承一个容器，自动同步它的数据。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 启动容器centos1,挂载容器内的目录/home/centos1</span></span><br><span class="line">docker run -it --name centos1 -v centos1:/home/centos1/ centos /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 在centos1容器的/home/centos1目录下创建centos1.txt文件</span></span><br><span class="line">[root@69a8809a9e6f centos1]# pwd</span><br><span class="line">/home/centos1</span><br><span class="line">[root@69a8809a9e6f centos1]# ls</span><br><span class="line">centos1.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 查看宿主机上centos1的挂载目录</span></span><br><span class="line">[root@ming _data]# pwd</span><br><span class="line">/var/lib/docker/volumes/centos1/_data</span><br><span class="line">[root@ming _data]# ls</span><br><span class="line">centos1.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 启动容器centos2，centos2继承自centos1</span></span><br><span class="line">docker run -it --name centos2 --volumes-from centos1 centos /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 进入到centos2的/home/centos1目录下</span></span><br><span class="line">[root@a5afec9346bd centos1]# pwd</span><br><span class="line">/home/centos1</span><br><span class="line">[root@a5afec9346bd centos1]# ls</span><br><span class="line">centos1.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在centos2的目录下，可以看到centos1的目录</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6. centos2容器中,在centos1目录中创建centos2.txt</span></span><br><span class="line">[root@a5afec9346bd centos2]# pwd</span><br><span class="line">/home/centos1</span><br><span class="line">[root@a5afec9346bd centos2]# ls</span><br><span class="line">centos1.txt centos2.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 7. 进入到centos1容器中，查看/home/centos1目录下是否多了centos2.txt</span></span><br><span class="line">[root@06e27ea51ee0 centos1]# ls  # centos1的目录下,存在centos2.txt，说明centos2创建的文件自动同步到centos1</span><br><span class="line">centos1.txt centos2.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 8. 查看centos2的挂载目录</span></span><br><span class="line">docker inspect centos2</span><br><span class="line">"Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "centos1",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/centos1/_data",</span><br><span class="line">                "Destination": "/home/centos1",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 9. 查看centos1的挂载目录</span></span><br><span class="line">docker inspect centos1</span><br><span class="line">"Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "centos1",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/centos1/_data",</span><br><span class="line">                "Destination": "/home/centos1",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "z",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论：centos1和centos2挂载的是同一个目录，连name都是相同的centos1。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这意味着，我们查看centos2的详细数据卷信息，也是使用docker volume inspect centos1</span></span><br></pre></td></tr></table></figure>

<p>接下来，我们创建一个新的容器centos3，让它–volumes-from centos2,它能不能自动同步centos2创建的目录centos2呢？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 启动centos3容器</span></span><br><span class="line">docker run -it --name centos3 --volumes-from centos2 centos /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查看/home目录下是否存在centos2目录</span></span><br><span class="line">[root@96b772d61de0 home]# ls  # 说明centos3不能同步centos2创建的目录</span><br><span class="line">centos1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 查看centos3挂载的目录信息</span></span><br><span class="line">docker inspect centos3</span><br><span class="line">"Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "centos1",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/centos1/_data",</span><br><span class="line">                "Destination": "/home/centos1",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> centos3虽然继承自centos2，但是centos2是继承自centos1，挂载的只是centos1的目录，所以centos3不能同步centos2创建的目录。</span></span><br></pre></td></tr></table></figure>

<h4 id="8-5-Macos数据卷挂载目录"><a href="#8-5-Macos数据卷挂载目录" class="headerlink" title="8.5 Macos数据卷挂载目录"></a>8.5 Macos数据卷挂载目录</h4><p>Macos系统中,Docker与宿主机之间多了一层Linux,无法直接查看数据卷挂载的目录.<br>可以重新创建一个Debian的Linux虚拟机,在<code>/var/lib/docker/volumes/</code>目录下可以查看docker挂载的数据卷.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 拉取了一个debian的镜像</span></span><br><span class="line">docker run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入/var/lib/docker/volumes既可以看到docker挂载的数据卷</span></span><br><span class="line">/var/lib/docker/volumes # ls</span><br><span class="line">backingFsBlockDev</span><br><span class="line">metadata.db</span><br><span class="line">mysqldata</span><br></pre></td></tr></table></figure>

<h3 id="9-Dockfile"><a href="#9-Dockfile" class="headerlink" title="9.Dockfile"></a>9.Dockfile</h3><p>我们可以使用Docker官方(或其他人)编写的镜像.也可以使用Dockerfile创建自己的镜像.我们以后要发布项目,就需要编写dockfile文件.</p>
<h4 id="9-1-制作Dockefile"><a href="#9-1-制作Dockefile" class="headerlink" title="9.1 制作Dockefile"></a>9.1 制作Dockefile</h4><p>dockerfile就是一个脚本文件,里面的脚本用来创建镜像.<br>dockerfile文件的命名官方推荐为<code>Dockerfile</code>.<br>Dockerfile文件所在的目录称为<code>上下文目录</code>,当执行docker commit提交的时候,会将上下文路径的所有路径上传到Docker Server端.<br>所以,要么Dockerfile文件所在上下文目录存放的全部都是构建镜像所需要的文件,<br>要么添加Dockerignore文件描述构建镜像时需要忽略的文件.</p>
<p>需要注意的几点：</p>
<ul>
<li>每个保留关键字（指令）都必须是大写字母</li>
<li>执行从上到下顺序执行</li>
<li>每一个指令都会创建提交一个新的镜像层，并提交</li>
<li>必须使用双引号，单引号不行</li>
<li>Dockerfile的第一条指令必须是FROM</li>
</ul>
<p>写好脚本文件后,使用<code>docker build</code>命令生成镜像.<br>需要注意的几点：</p>
<ul>
<li>-t 生成的镜像名称不能带/</li>
<li>最后一个参数指定上下文路径,’.’代表当前所在目录</li>
<li>如果文件命名为Dockerfile，在docker build的时候可以不指定-f参数.否则可以通过-f指定Dockerfile文件所在的目录</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 利用当前目录下的dockerfile文件在当前目录下生成xiaoming/centos的镜像</span></span><br><span class="line">[root@ming docker_volume_test]# docker build -f dockerfile1 -t xiaoming/centos .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 300e315adb2f</span></span><br><span class="line">Step 2/4 : VOLUME ["volume1","volume2"]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 7d9097ed198e</span></span><br><span class="line">Removing intermediate container 7d9097ed198e</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 8f3d72c8bccc</span></span><br><span class="line">Step 3/4 : CMD echo '------end------'</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 27f56b2fe602</span></span><br><span class="line">Removing intermediate container 27f56b2fe602</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> bdcf8bb3ee27</span></span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> e9c64f298af8</span></span><br><span class="line">Removing intermediate container e9c64f298af8</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 7fc575cbe035</span></span><br><span class="line">Successfully built 7fc575cbe035</span><br><span class="line">Successfully tagged xiaoming/centos:latest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数解释</span></span><br><span class="line">-f # 指定的dockfile文件</span><br><span class="line">-t # target,生成的目录镜像</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查看镜像</span></span><br><span class="line">[root@ming docker_volume_test]# docker images</span><br><span class="line">REPOSITORY        TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">xiaoming/centos   latest    7fc575cbe035   21 seconds ago   209MB  # 利用dockerfile生成的镜像文件</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 启动容器</span></span><br><span class="line">[root@ming docker_volume_test]# docker run -it xiaoming/centos /bin/bash</span><br><span class="line">[root@40476da59260 /]# ls -l</span><br><span class="line">drwxr-xr-x  2 root root 4096 Jan  3 07:14 volume1 # 生成镜像的时候自动挂载的volume1目录</span><br><span class="line">drwxr-xr-x  2 root root 4096 Jan  3 07:14 volume2 # 生成镜像的时候自动挂载的volume2目录</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 在容器内的volume1目录中创建文件volume1.txt</span></span><br><span class="line">[root@40476da59260 volume1]# pwd</span><br><span class="line">/volume1</span><br><span class="line">[root@40476da59260 volume1]# ls</span><br><span class="line">volume1.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 查看挂载信息</span></span><br><span class="line">docker inspect 40476da59260  # 容器id</span><br><span class="line">"Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "188f9cd826889b4497db0df774a3c493666b808bce0cffbadc90ae20901fda49",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/188f9cd826889b4497db0df774a3c493666b808bce0cffbadc90ae20901fda49/_data",</span><br><span class="line">                "Destination": "volume1",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "9ecc05996ab6035f6fee907b130473f8ad9eba1244635a98bbf3e5dbde8747a8",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/9ecc05996ab6035f6fee907b130473f8ad9eba1244635a98bbf3e5dbde8747a8/_data",</span><br><span class="line">                "Destination": "volume2",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6. 到挂载目录下查看是否同步了容器的文件</span></span><br><span class="line">[root@ming _data]# pwd</span><br><span class="line">/var/lib/docker/volumes/188f9cd826889b4497db0df774a3c493666b808bce0cffbadc90ae20901fda49/_data</span><br><span class="line">[root@ming _data]# ls</span><br><span class="line">volume1.txt  # 容器内创建的文件已经同步，说明挂载成功。</span><br></pre></td></tr></table></figure>

<h4 id="9-2-Dockfile指令"><a href="#9-2-Dockfile指令" class="headerlink" title="9.2 Dockfile指令"></a>9.2 Dockfile指令</h4><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>FROM</td>
<td>指定基础镜像，一切从这里开始构建</td>
</tr>
<tr>
<td>MAINTAINER</td>
<td>指定维护者信息（姓名+邮箱）</td>
</tr>
<tr>
<td>RUN</td>
<td>镜像构建的时候需要运行的命令</td>
</tr>
<tr>
<td>ADD</td>
<td>添加内容，会自动解压</td>
</tr>
<tr>
<td>WORKDIR</td>
<td>镜像的工作目录</td>
</tr>
<tr>
<td>VOLUME</td>
<td>设置卷，挂载主机目录</td>
</tr>
<tr>
<td>EXPOSE</td>
<td>暴露端口配置</td>
</tr>
<tr>
<td>CMD</td>
<td>指定容器启动的时候运行的命令，只有最后一个会生效</td>
</tr>
<tr>
<td>ENTRYPOINT</td>
<td>指定这个容器启动的时候运行的命令，可以追加命令</td>
</tr>
<tr>
<td>ONBUILD</td>
<td>当构建一个被继承Dockfile就会触发指令</td>
</tr>
<tr>
<td>COPY</td>
<td>类似ADD,将文件拷贝到镜像中</td>
</tr>
<tr>
<td>ENV</td>
<td>构建的时候设置环境变量</td>
</tr>
</tbody></table>
<h5 id="9-2-1-FROM"><a href="#9-2-1-FROM" class="headerlink" title="9.2.1 FROM"></a>9.2.1 FROM</h5><p>FROM 指令表明构建的镜像是基于FROM指定的这个镜像构建的.<br>Dockerfile的第一条指令就必须是FROM指令.<br>以后我们将自己的项目构建成一个容器的时候,比如需要JDK的开发环境,就应该基于一个包含JDK环境的镜像去构建.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 当前目录下存在Dockerfile文件和hello.txt文件</span></span><br><span class="line">[root@aliyun dockfile]# ls</span><br><span class="line">Dockerfile  hello.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 构建镜像,-t指定构建后镜像的名称, . 代表基于当前的路径构建镜像,即指定上下文目录</span></span><br><span class="line">[root@aliyun dockfile]# docker build -t mycentos:01 .</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/1 : FROM centos:7   # 每一条指令都会生成一个镜像层,镜像层可以复用</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> eeb6ee3f44bd</span></span><br><span class="line">Successfully built eeb6ee3f44bd</span><br><span class="line">Successfully tagged mycentos:01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看刚刚构建的镜像</span></span><br><span class="line">[root@aliyun dockfile]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">tomcat       latest    24207ccc9cce   9 days ago     680MB</span><br><span class="line">centos       7         eeb6ee3f44bd   3 months ago   204MB</span><br><span class="line">mycentos     01        eeb6ee3f44bd   3 months ago   204MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动镜像,发现自动退出了,是因为镜像中没有服务在运行,容器就自动退出了</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以使用-it以交互的形式启动</span></span><br><span class="line">[root@aliyun dockfile]# docker run --name mycentos mycentos:01</span><br><span class="line">[root@aliyun dockfile]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND       CREATED         STATUS                     PORTS     NAMES</span><br><span class="line">114aad00ed59   mycentos:01   "/bin/bash"   3 seconds ago   Exited (0) 2 seconds ago             mycentos</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 以交互形式启动容器并进入容器</span></span><br><span class="line">[root@aliyun dockfile]# docker run -it --name mycentos mycentos:01 bash</span><br></pre></td></tr></table></figure>

<h5 id="9-2-2-RUN"><a href="#9-2-2-RUN" class="headerlink" title="9.2.2 RUN"></a>9.2.2 RUN</h5><p>RUN可以在创建镜像时执行命令.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器中安装vim</span></span><br><span class="line">RUN yum install -y vim</span><br></pre></td></tr></table></figure>

<p>每一个RUN都是启动一个容器、执行命令、然后提交存储层文件变更.<br>第一层<code>RUN cd /app</code>的执行仅仅是当前进程的工作目录变更,一个内存上的变化而已,其结果不会造成任何文件变更.<br>而到第二层的时候,启动的是一个全新的容器,跟第一层的容器更完全没关系,自然不可能继承前一层构建过程中的内存变化.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN cd /app</span><br><span class="line">RUN echo "hello" &gt; world.txt</span><br></pre></td></tr></table></figure>

<h5 id="9-2-3-EXPOSE"><a href="#9-2-3-EXPOSE" class="headerlink" title="9.2.3 EXPOSE"></a>9.2.3 EXPOSE</h5><p>EXPOSE声明容器对外暴露的端口,并不会在自动在宿主机上进行端口映射.<br>即使不声明也是可以在运行容器的时候进行端口映射的,但是遵守规范,还是在Dockerfile文件中声明一下.<br>如果在启动容器时使用随机端口映射(-P),会自动映射EXPOSE端口.<br>EXPOSE 指令可以声明多次.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPOSE 8080</span><br><span class="line">EXPOST 8081</span><br></pre></td></tr></table></figure>

<h5 id="9-2-4-WORKDIR"><a href="#9-2-4-WORKDIR" class="headerlink" title="9.2.4 WORKDIR"></a>9.2.4 WORKDIR</h5><p>WORKDIR 指定进入容器时的默认工作路径.<br>如果WORKDIR指定的目录不存在,会自动创建.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR /usr/local</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器后,默认的工作路径就是/usr/<span class="built_in">local</span></span></span><br><span class="line">[root@aliyun dockfile]# docker run -it mytomcat:02 bash</span><br><span class="line">root@33353414815f:/usr/local# pwd</span><br><span class="line">/usr/local</span><br></pre></td></tr></table></figure>

<p>WORKDIR 可以声明多次.<br>如果每个WORKDIR指令声明的都是绝对路径,以最后一个绝对路径为准.<br>如果最后一个WORKDIR指令声明的是相对路径,会将多个WORKDIR的路径连接在一起.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Dockerfile文件中声明多条WORKDIR指令,后面两条WORKDIR指令是相对路径</span></span><br><span class="line">WORKDIR /usr/local</span><br><span class="line">WORKDIR tomcat</span><br><span class="line">WORKDIR webapps</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 最终容器内的工作目录是/usr/<span class="built_in">local</span>/tomcat/webapps</span></span><br><span class="line">[root@aliyun dockfile]# docker run -it mytomcat:02 bash</span><br><span class="line">root@0a4ce65817ab:/usr/local/tomcat/webapps# pwd</span><br><span class="line">/usr/local/tomcat/webapps</span><br></pre></td></tr></table></figure>

<h5 id="9-2-5-COPY"><a href="#9-2-5-COPY" class="headerlink" title="9.2.5 COPY"></a>9.2.5 COPY</h5><p>COPY 拷贝文件到容器内.<br>源路径(宿主机上的路径)只能写相对路径(一般都是在上下文目录中),不能写绝对路径.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 绝对路径</span></span><br><span class="line">COPY  hello.index /usr/local/tomcat/webapps</span><br></pre></td></tr></table></figure>

<p>源路径可以指定多个.<br>如果源路径为文件夹,复制的时候不是直接复制该文件夹,而是将文件夹中的内容复制到目标路径.<br>如果源路径为文件夹,目标路径以/结尾.<br>目标路径可以是相对路径,相对于WORKDIR的相对路径.<br>复制源路径的时候,源文件的用户｜权限等信息都会保留,可以在CPOY指定–chown修改文件的所属用户和所属组.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM tomcat</span><br><span class="line"></span><br><span class="line">WORKDIR /usr/local</span><br><span class="line">WORKDIR tomcat</span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制宿主机的hello.txt和app目录到容器内的/usr/<span class="built_in">local</span>/tomcat/webapps目录中</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里使用的是相对于WORKDIR的相对路径</span></span><br><span class="line">COPY hello.txt app webapps/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 源文件的用户和用户组都被复制过来了</span></span><br><span class="line">root@8d48ef0e9be1:/usr/local/tomcat/webapps# ls -l</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 root root 15 Dec 23 16:01 hello.index</span><br><span class="line">-rw-r--r-- 1 root root 42 Dec 18 16:35 hello.txt</span><br></pre></td></tr></table></figure>

<h5 id="9-2-6-ADD"><a href="#9-2-6-ADD" class="headerlink" title="9.2.6 ADD"></a>9.2.6 ADD</h5><p>ADD与COPY命令相似,它可以指定一个url,从url中下载文件到指定目录中.<br>下载的文件权限默认是600.可以使用RUN命令进行权限的调整.所以,还不如使用RUN + WGET(CURL)下载文件并处理好权限后再上传到容器中.<br>从远程的url中下载文件到容器中,并不会自动解压.<br>从上下文目录中上传文件到容器中,会自动进行解压.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载yum的安装包到容器内的/usr/<span class="built_in">local</span>/tomcat中</span></span><br><span class="line">ADD http://yum.baseurl.org/download/3.2/yum-3.2.28.tar.gz /usr/local/tomcat</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器内,安装包成功下载,但是并没有解压</span></span><br><span class="line">root@2046c78ec7e5:/usr/local/tomcat# ls</span><br><span class="line">BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist  yum-3.2.28.tar.gz</span><br><span class="line">CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 从上下文路径中上传tar包到容器内指定的目录</span></span><br><span class="line">FROM tomcat</span><br><span class="line">WORKDIR /usr/local</span><br><span class="line">WORKDIR tomcat</span><br><span class="line">ADD yum-3.2.28.tar.gz /usr/local/tomcat</span><br><span class="line">RUN cd /usr/local/tomcat/   </span><br><span class="line">RUN mv yum-3.2.28 yum</span><br><span class="line">WORKDIR yum </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器内查看,tar已经自动解压</span></span><br><span class="line">root@0f124e894e13:/usr/local/tomcat/yum# ls</span><br><span class="line">AUTHORS    FAQ	     PLUGINS  bin	   docs       po	test	  yum-updatesd.py  yummain.py</span><br><span class="line">COPYING    INSTALL   README   callback.py  etc	      rpmUtils	utils.py  yum.spec</span><br><span class="line">ChangeLog  Makefile  TODO     cli.py	   output.py  shell.py	yum	  yumcommands.py</span><br></pre></td></tr></table></figure>

<p><strong>因此在<code>COPY</code>和<code>ADD</code>指令中选择的时候,可以遵循这样的原则,所有的文件复制均使用<code>COPY</code>指令,仅在需要自动解压缩的场合使用<code>ADD</code>.</strong></p>
<h5 id="9-2-7-VOLUME"><a href="#9-2-7-VOLUME" class="headerlink" title="9.2.7 VOLUME"></a>9.2.7 VOLUME</h5><p>VOLUME使用匿名挂载容器内的数据卷.<br>为了避免在启动容器的时候忘记挂载数据卷,可以在Dockerfile文件中指定VOLUME匿名挂载.当容器启动时,如果使用-d指定了数据卷挂载,Dockerfile中的VOLUME会被覆盖.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> dockerfile中挂载这两个目录</span></span><br><span class="line">VOLUME ["/usr/local/tomcat/webapps","/usr/local/tomcat/conf"]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 构建成镜像mytomcat:08并启动</span></span><br><span class="line">[root@aliyun dockfile]# docker run -d --name mytomcat mytomcat:08</span><br><span class="line">5d2efc3a8ccca3c57b7c482ada72e1f646b4fd20c6f60709985c7551f58e357c</span><br><span class="line">[root@aliyun dockfile]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND             CREATED         STATUS         PORTS           NAMES</span><br><span class="line">5d2efc3a8ccc   mytomcat:08   "catalina.sh run"   3 seconds ago   Up 2 seconds   8080-8081/tcp   nostalgic_moor</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看mytomcat:08的挂载信息</span></span><br><span class="line">[root@aliyun dockfile]# docker inspect mytomcat</span><br><span class="line">"Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "c5f6f552ffd603fd0695488a1580051c619bdae946087b1078aed86c1efa3569",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/c5f6f552ffd603fd0695488a1580051c619bdae946087b1078aed86c1efa3569/_data",</span><br><span class="line">                "Destination": "/usr/local/tomcat/conf",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "d55e90013313c951f40ac0830e1079380352df53afd82be69d7b03c3a2b6517f",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/d55e90013313c951f40ac0830e1079380352df53afd82be69d7b03c3a2b6517f/_data",</span><br><span class="line">                "Destination": "/usr/local/tomcat/webapps",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看匿名挂载的数据卷</span></span><br><span class="line">[root@aliyun volumes]# ls</span><br><span class="line">apps</span><br><span class="line">backingFsBlockDev</span><br><span class="line">c5f6f552ffd603fd0695488a1580051c619bdae946087b1078aed86c1efa3569   # /usr/local/tomcat/conf</span><br><span class="line">confs</span><br><span class="line">d55e90013313c951f40ac0830e1079380352df53afd82be69d7b03c3a2b6517f   # /usr/local/tomcat/webapps</span><br><span class="line">metadata.db</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在Dockfile文件中指定了VOLUME,但是在启动容器的时候也挂载了自定义的数据卷,Dockfile文件中匿名挂载的数据卷会被覆盖</span></span><br><span class="line">[root@aliyun dockfile]# docker run -d -v apps:/usr/local/tomcat/webapps mytomcat:08</span><br><span class="line">[root@aliyun dockfile]# docker inspect mytomcat</span><br><span class="line">"Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "apps",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/apps/_data",  # 容器中的/usr/local/tomcat/webapps被挂载到了apps</span><br><span class="line">                "Destination": "/usr/local/tomcat/webapps",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "z",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "e92f66076c6b742ea9b1f3286c51b671e2ed3ce93d3b1d2b4485e1a31c1e91e8",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/ e92f66076c6b742ea9b1f3286c51b671e2ed3ce93d3b1d2b4485e1a31c1e91e8/_data", # 容器中的/usr/local/tomcat/conf还是Dockerfile文件中指定的匿名挂载</span><br><span class="line">                "Destination": "/usr/local/tomcat/conf",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br></pre></td></tr></table></figure>

<h5 id="9-2-8-EMV"><a href="#9-2-8-EMV" class="headerlink" title="9.2.8 EMV"></a>9.2.8 EMV</h5><p>EMV 设置环境变量,在EMV指令之后的指令都可以通过$()来使用环境变量</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ENV MAINDIR /usr/local/tomcat</span><br><span class="line">WORKDIR $MAINDIR</span><br></pre></td></tr></table></figure>

<h5 id="9-2-9-CMD"><a href="#9-2-9-CMD" class="headerlink" title="9.2.9 CMD"></a>9.2.9 CMD</h5><p>CMD指令指定在容器启动时(docker run)执行的命令.<br>CMD指令有两种方式:</p>
<ul>
<li>shell模式: CMD ls /usr/local/tomcat  实际上会被包装成 CMD [“sh”,”-c”,”ls”,”/usr/local/tomcat”],由于sh的存在,可以使用环境变量.</li>
<li>exec模式:  CMD [“ls”,”/usr/local/tomcat”]<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CMD ["ls","/usr/local/tomcat"]</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>当在Dockerfile指定了CMD指令的时候,可以在启动容器时覆盖CMD命令.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CMD ["ls","-l"]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 覆盖了dockerfile中的ls -l指令,而/usr不是一个有效的命令,所以报错</span></span><br><span class="line">[root@aliyun dockfile]# docker run -it mytomcat:09 /usr</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: exec: "/usr": permission denied: unknown.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用有效的命令可以覆盖Dockerfile中的CMD指令</span></span><br><span class="line">[root@aliyun dockfile]# docker run -it mytomcat:09 ls -l /usr</span><br><span class="line">total 36</span><br><span class="line">drwxr-xr-x 1 root root 4096 Dec  8 20:53 bin</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct  3 09:15 games</span><br><span class="line">drwxr-xr-x 1 root root 4096 Dec  8 20:53 include</span><br><span class="line">drwxr-xr-x 1 root root 4096 Dec  8 20:53 lib</span><br><span class="line">drwxr-xr-x 1 root root 4096 Dec  2 11:34 libexec</span><br><span class="line">drwxr-xr-x 1 root root 4096 Dec  3 14:11 local</span><br><span class="line">drwxr-xr-x 1 root root 4096 Dec  2 03:39 sbin</span><br><span class="line">drwxr-xr-x 1 root root 4096 Dec  8 20:53 share</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct  3 09:15 src</span><br></pre></td></tr></table></figure>

<h5 id="9-2-10-ENTRYPOINT"><a href="#9-2-10-ENTRYPOINT" class="headerlink" title="9.2.10 ENTRYPOINT"></a>9.2.10 ENTRYPOINT</h5><p>ENTRYPOINT和CMD指令有着类似的功能.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Dockerfile中指令</span></span><br><span class="line">ENTRYPOINT ["ls","-l","/"]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动时执行Dockerfile中的ENTYRYPOINT指令 ls -l /</span></span><br><span class="line">[root@aliyun dockfile]# docker run mytomcat:09</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  2 11:34 bin</span><br><span class="line">drwxr-xr-x  2 root root 4096 Oct  3 09:15 boot</span><br><span class="line">drwxr-xr-x  5 root root  340 Dec 23 14:57 dev</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec 23 14:57 etc</span><br><span class="line">drwxr-xr-x  2 root root 4096 Oct  3 09:15 home</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  8 20:53 lib</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 lib64</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 media</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 mnt</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 opt</span><br><span class="line">dr-xr-xr-x 89 root root    0 Dec 23 14:57 proc</span><br><span class="line">drwx------  1 root root 4096 Dec  2 11:34 root</span><br><span class="line">drwxr-xr-x  3 root root 4096 Dec  1 00:00 run</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  2 03:40 sbin</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 srv</span><br><span class="line">dr-xr-xr-x 13 root root    0 Dec 23 14:57 sys</span><br><span class="line">drwxrwxrwt  1 root root 4096 Dec  8 20:53 tmp</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  1 00:00 usr</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  1 00:00 var</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动容器时使用--entrypoint覆盖Dockerfile中的ENTRYPOINT指令</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意--entrypoint要写在<span class="string">'镜像名称'</span>前后,如果写在镜像名称后面,会被当成CMD指令</span></span><br><span class="line">[root@aliyun dockfile]# docker run  --entrypoint ls -l /usr/local/tomcat mytomcat:09</span><br><span class="line">BUILDING.txt</span><br><span class="line">CONTRIBUTING.md</span><br><span class="line">LICENSE</span><br><span class="line">NOTICE</span><br><span class="line">README.md</span><br><span class="line">RELEASE-NOTES</span><br><span class="line">RUNNING.txt</span><br><span class="line">bin</span><br><span class="line">conf</span><br><span class="line">lib</span><br><span class="line">logs</span><br><span class="line">native-jni-lib</span><br><span class="line">temp</span><br><span class="line">webapps</span><br><span class="line">webapps.dist</span><br><span class="line">work</span><br></pre></td></tr></table></figure>

<h5 id="9-2-11-CMD-ENTRYPOINT区别"><a href="#9-2-11-CMD-ENTRYPOINT区别" class="headerlink" title="9.2.11 CMD|ENTRYPOINT区别"></a>9.2.11 CMD|ENTRYPOINT区别</h5><p>如果在Dockerfile文件中同时指定了CMD和ENTRYPOINT指令,CMD的含义就发生了改变,不再是直接的运行其命令,而是将CMD的内容作为参数传给 ENTRYPOINT 指令,换句话说实际执行时,将变为<code>ENTRYPOINT CMD</code>.</p>
<p>应用场景1: 在Dockerfile文件中指定ENTRYPOINT默认运行的命令,在启动容器的时候指定CMD指令,CMD指令会被当成ENTRYPOINT的参数,从而达到<code>动态添加执行参数</code>的效果.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Dockerfile中指令</span></span><br><span class="line">ENTRYPOINT ["ls","-l","/"]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 相当于执行了ls -l / /usr/<span class="built_in">local</span>/tomcat </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 会将/和/usr/<span class="built_in">local</span>/tomcat目录下的文件都列出来</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Dockerfile中默认运行的指令是ls -l /,/usr/<span class="built_in">local</span>/tomcat是在容器启动时<span class="string">'动态添加的'</span></span></span><br><span class="line">[root@aliyun dockfile]# docker run mycentos:09 /usr/local/tomcat</span><br><span class="line">/:</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  2 11:34 bin</span><br><span class="line">drwxr-xr-x  2 root root 4096 Oct  3 09:15 boot</span><br><span class="line">drwxr-xr-x  5 root root  340 Dec 19 15:42 dev</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec 19 15:42 etc</span><br><span class="line">drwxr-xr-x  2 root root 4096 Oct  3 09:15 home</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  8 20:53 lib</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 lib64</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 media</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 mnt</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 opt</span><br><span class="line">dr-xr-xr-x 87 root root    0 Dec 19 15:42 proc</span><br><span class="line">drwx------  1 root root 4096 Dec  2 11:34 root</span><br><span class="line">drwxr-xr-x  3 root root 4096 Dec  1 00:00 run</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  2 03:40 sbin</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 srv</span><br><span class="line">dr-xr-xr-x 13 root root    0 Dec 19 15:42 sys</span><br><span class="line">drwxrwxrwt  1 root root 4096 Dec  8 20:53 tmp</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  1 00:00 usr</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  1 00:00 var</span><br><span class="line"></span><br><span class="line">/usr/local/tomcat:</span><br><span class="line">total 160</span><br><span class="line">-rw-r--r-- 1 root root 18994 Dec  2 22:01 BUILDING.txt</span><br><span class="line">-rw-r--r-- 1 root root  6210 Dec  2 22:01 CONTRIBUTING.md</span><br><span class="line">-rw-r--r-- 1 root root 60269 Dec  2 22:01 LICENSE</span><br><span class="line">-rw-r--r-- 1 root root  2333 Dec  2 22:01 NOTICE</span><br><span class="line">-rw-r--r-- 1 root root  3378 Dec  2 22:01 README.md</span><br><span class="line">-rw-r--r-- 1 root root  6905 Dec  2 22:01 RELEASE-NOTES</span><br><span class="line">-rw-r--r-- 1 root root 16517 Dec  2 22:01 RUNNING.txt</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec  8 20:53 bin</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec  2 22:01 conf</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec  8 20:53 lib</span><br><span class="line">drwxrwxrwx 2 root root  4096 Dec  2 22:01 logs</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec  8 20:53 native-jni-lib</span><br><span class="line">drwxrwxrwx 2 root root  4096 Dec  8 20:53 temp</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec  8 20:53 webapps</span><br><span class="line">drwxr-xr-x 7 root root  4096 Dec  2 22:01 webapps.dist</span><br><span class="line">drwxrwxrwx 2 root root  4096 Dec  2 22:01 work</span><br></pre></td></tr></table></figure>

<p>应用场景2: 在Dockerfile文件中通过ENTRYPOINT指定通用的命令,在容器启动时指定CMD指令,CMD指令会被当成ENTRYPOINT的参数,从而达到<code>动态传参</code>的效果.<br>比如在发布springboot项目的时候,运行java -jar 项目名,只是项目名称不同,执行的命令都是一致的,就可以使用这种方法来动态传参.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">CMD ["/usr/local/tomcat"]</span><br><span class="line">ENTRYPOINT ["ls","-l"]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CMD和ENTRYPOINT一起执行了,相当于执行了 ls -l /usr/<span class="built_in">local</span>/tomcat</span></span><br><span class="line">[root@aliyun dockfile]# docker run mytomcat:09</span><br><span class="line">total 160</span><br><span class="line">-rw-r--r-- 1 root root 18994 Dec  2 22:01 BUILDING.txt</span><br><span class="line">-rw-r--r-- 1 root root  6210 Dec  2 22:01 CONTRIBUTING.md</span><br><span class="line">-rw-r--r-- 1 root root 60269 Dec  2 22:01 LICENSE</span><br><span class="line">-rw-r--r-- 1 root root  2333 Dec  2 22:01 NOTICE</span><br><span class="line">-rw-r--r-- 1 root root  3378 Dec  2 22:01 README.md</span><br><span class="line">-rw-r--r-- 1 root root  6905 Dec  2 22:01 RELEASE-NOTES</span><br><span class="line">-rw-r--r-- 1 root root 16517 Dec  2 22:01 RUNNING.txt</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec  8 20:53 bin</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec  2 22:01 conf</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec  8 20:53 lib</span><br><span class="line">drwxrwxrwx 2 root root  4096 Dec  2 22:01 logs</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec  8 20:53 native-jni-lib</span><br><span class="line">drwxrwxrwx 2 root root  4096 Dec  8 20:53 temp</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec  8 20:53 webapps</span><br><span class="line">drwxr-xr-x 7 root root  4096 Dec  2 22:01 webapps.dist</span><br><span class="line">drwxrwxrwx 2 root root  4096 Dec  2 22:01 work</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以在启动容器的时候覆盖CMD命令,相当于执行了 ls -l /</span></span><br><span class="line">[root@aliyun dockfile]# docker run mytomcat:09 /</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  2 11:34 bin</span><br><span class="line">drwxr-xr-x  2 root root 4096 Oct  3 09:15 boot</span><br><span class="line">drwxr-xr-x  5 root root  340 Dec 19 15:04 dev</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec 19 15:04 etc</span><br><span class="line">drwxr-xr-x  2 root root 4096 Oct  3 09:15 home</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  8 20:53 lib</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 lib64</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 media</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 mnt</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 opt</span><br><span class="line">dr-xr-xr-x 85 root root    0 Dec 19 15:04 proc</span><br><span class="line">drwx------  1 root root 4096 Dec  2 11:34 root</span><br><span class="line">drwxr-xr-x  3 root root 4096 Dec  1 00:00 run</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  2 03:40 sbin</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  1 00:00 srv</span><br><span class="line">dr-xr-xr-x 13 root root    0 Dec 19 15:04 sys</span><br><span class="line">drwxrwxrwt  1 root root 4096 Dec  8 20:53 tmp</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  1 00:00 usr</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  1 00:00 var</span><br></pre></td></tr></table></figure>

<h5 id="9-2-12-HEALTHCHECK"><a href="#9-2-12-HEALTHCHECK" class="headerlink" title="9.2.12 HEALTHCHECK"></a>9.2.12 HEALTHCHECK</h5><p>HEALTHCHECK指令指定一行命令,用这行命令来判断容器主进程的服务状态是否还正常,从而比较真实的反应容器实际状态.</p>
<p>当在一个镜像指定了HEALTHCHECK指令后,用其启动容器,初始状态会为<code>starting</code>,在HEALTHCHECK指令检查成功后变为<code>healthy</code>,如果连续一定次数失败,则会变为<code>unhealthy</code>.</p>
<p>HEALTHCHECK 支持下列选项:<br>–interval=&lt;间隔&gt;:两次健康检查的间隔,默认为30秒<br>–timeout=&lt;时长&gt;:健康检查命令运行超时时间,如果超过这个时间,本次健康检查就被视为失败,默认30秒<br>–retries=&lt;次数&gt;:当连续失败指定次数后,则将容器状态视为unhealthy,默认3次</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 这里举个例子,也就是说每隔5s向hello.txt文件中打印一句<span class="string">'healthcheck'</span></span></span><br><span class="line">HEALTHCHECK --interval=5s --timeout=3s --retries=3 CMD echo "healthcheck" &gt;&gt; hello.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器钢启动,初始状态为starting</span></span><br><span class="line">[root@aliyun dockfile]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND             CREATED         STATUS                            PORTS           NAMES</span><br><span class="line">c0ff58d3a715   mytomcat:09   "catalina.sh run"   3 seconds ago   Up 2 seconds (health: starting)   8080-8081/tcp   elated_germain</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> HEALTHCHECK检查成功后,容器状态变成healthy</span></span><br><span class="line">[root@aliyun dockfile]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND             CREATED         STATUS                   PORTS           NAMES</span><br><span class="line">c0ff58d3a715   mytomcat:09   "catalina.sh run"   4 minutes ago   Up 4 minutes (healthy)   8080-8081/tcp   elated_germain</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过docker inspect查看healthcheck的状态,每一次启动都会执行一次HEALTHCHECK</span></span><br><span class="line">"Health": &#123;</span><br><span class="line">    "Status": "healthy",</span><br><span class="line">    "FailingStreak": 0,</span><br><span class="line">    "Log": [</span><br><span class="line">        &#123;</span><br><span class="line">            "Start": "2021-12-24T18:13:59.064542488+08:00",</span><br><span class="line">            "End": "2021-12-24T18:13:59.119104436+08:00",</span><br><span class="line">            "ExitCode": 0,</span><br><span class="line">            "Output": ""</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br><span class="line">"Healthcheck": &#123;</span><br><span class="line">    "Test": [</span><br><span class="line">        "CMD-SHELL",</span><br><span class="line">        "echo \"healthcheck\" &gt;&gt; hello.txt"</span><br><span class="line">    ],</span><br><span class="line">    "Interval": 5000000000,</span><br><span class="line">    "Timeout": 3000000000,</span><br><span class="line">    "Retries": 3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="9-2-13-USER"><a href="#9-2-13-USER" class="headerlink" title="9.2.13 USER"></a>9.2.13 USER</h5><p>USER指令切换用户,对后面的RUN等其他指令生效.<br>USER指定的用户必须存在.否则报错<code>unable to find user test: no matching entries in passwd file.</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN groupadd -r tomcat &amp;&amp; useradd -r tomcat -g tomcat</span><br><span class="line">USER tomcat</span><br></pre></td></tr></table></figure>

<h4 id="9-3-查看构建过程"><a href="#9-3-查看构建过程" class="headerlink" title="9.3 查看构建过程"></a>9.3 查看构建过程</h4><p>从镜像构造的过程来看,当执行docker build的时候,一条Dockerfile指令就对应着一层镜像层.<br>查看CREATED镜像层的创建时间可知,如果有共享的镜像层可以使用,则不会生成新的镜像层.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用docker <span class="built_in">history</span> 镜像id  可以查看一个镜像构建的过程</span></span><br><span class="line">[root@aliyun dockfile]# docker history mytomcat:09</span><br><span class="line">IMAGE          CREATED          CREATED BY                                      SIZE      COMMENT</span><br><span class="line">a67571bcc990   25 minutes ago   /bin/sh -c #(nop)  ENTRYPOINT ["ls" "-l"]       0B        </span><br><span class="line">c51982690654   8 hours ago      /bin/sh -c #(nop) WORKDIR /usr/local/tomcat     0B        </span><br><span class="line">e1d45fab1f8a   8 hours ago      /bin/sh -c #(nop) WORKDIR /usr/local            0B        </span><br><span class="line">fba543986ae7   8 hours ago      /bin/sh -c #(nop)  EXPOSE 8081                  0B        </span><br><span class="line">7ccc021ae63d   8 hours ago      /bin/sh -c #(nop)  EXPOSE 8080                  0B        </span><br><span class="line">24207ccc9cce   10 days ago      /bin/sh -c #(nop)  CMD ["catalina.sh" "run"]    0B        </span><br><span class="line">&lt;missing&gt;      10 days ago      /bin/sh -c #(nop)  EXPOSE 8080                  0B        </span><br><span class="line">&lt;missing&gt;      10 days ago      /bin/sh -c set -eux;  nativeLines="$(catalin…   0B        </span><br><span class="line">&lt;missing&gt;      10 days ago      /bin/sh -c set -eux;   savedAptMark="$(apt-m…   20.2MB    </span><br><span class="line">&lt;missing&gt;      10 days ago      /bin/sh -c #(nop)  ENV TOMCAT_SHA512=c2d2ad5…   0B        </span><br><span class="line">&lt;missing&gt;      10 days ago      /bin/sh -c #(nop)  ENV TOMCAT_VERSION=10.0.14   0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop)  ENV TOMCAT_MAJOR=10          0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop)  ENV GPG_KEYS=A9C5DF4D22E9…   0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop)  ENV LD_LIBRARY_PATH=/usr/…   0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop)  ENV TOMCAT_NATIVE_LIBDIR=…   0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop) WORKDIR /usr/local/tomcat     0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c mkdir -p "$CATALINA_HOME"            0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop)  ENV PATH=/usr/local/tomca…   0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop)  ENV CATALINA_HOME=/usr/lo…   0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop)  CMD ["jshell"]               0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c set -eux;   arch="$(dpkg --print-…   343MB     </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop)  ENV JAVA_VERSION=11.0.13     0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop)  ENV LANG=C.UTF-8             0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop)  ENV PATH=/usr/local/openj…   0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c &#123; echo '#/bin/sh'; echo 'echo "$J…   27B       </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop)  ENV JAVA_HOME=/usr/local/…   0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c set -eux;  apt-get update;  apt-g…   11.3MB    </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c apt-get update &amp;&amp; apt-get install…   152MB     </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c set -ex;  if ! command -v gpg &gt; /…   18.9MB    </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c set -eux;  apt-get update;  apt-g…   10.7MB    </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop)  CMD ["bash"]                 0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago      /bin/sh -c #(nop) ADD file:e777355768c63f735…   124MB</span><br></pre></td></tr></table></figure>

<h4 id="9-4-制作tomcat的Dockfile"><a href="#9-4-制作tomcat的Dockfile" class="headerlink" title="9.4 制作tomcat的Dockfile"></a>9.4 制作tomcat的Dockfile</h4><blockquote>
<p>准备tomcat，JDK的压缩包,编写Dockerfile</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 基于centos</span></span><br><span class="line">FROM centos</span><br><span class="line"><span class="meta">#</span><span class="bash"> 作者信息</span></span><br><span class="line">MAINTAINER xiaoming&lt;1149895826@qq.com&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载vim</span></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install rpm</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将当前目录下的压缩包发送到服务器，ADD指令会自动解压</span></span><br><span class="line">ADD apache-tomcat-8.5.61.tar.gz /usr/local/tomcat/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将当前目录下的JDK rpm包发送到服务器</span></span><br><span class="line">ADD jdk-8u271-linux-x64.rpm /usr/local/java/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载rpm包，安装JDK</span></span><br><span class="line">RUN cd /usr/local/java &amp;&amp; yum -y install /usr/local/java/jdk-8u271-linux-x64.rpm &amp;&amp; yum install which -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置环境变量,这里非常重要，稍微有一点错误，容器就启动不起来</span></span><br><span class="line">ENV JAVA_HOME /usr/java/jdk1.8.0_271-amd64</span><br><span class="line">ENV CLASSPATH .:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/tomcat/apache-tomcat-8.5.61</span><br><span class="line">ENV CATALINA_BASH /usr/local/tomcat/apache-tomcat-8.5.61</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置容器启动时的工作目录</span></span><br><span class="line">ENV MAINPATH /usr/local/tomcat</span><br><span class="line">WORKDIR $MAINPATH</span><br><span class="line"><span class="meta">#</span><span class="bash"> 暴露容器的端口</span></span><br><span class="line">EXPOSE 8080</span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器启动时执行的命令：启动tomcat，并打印启动日志</span></span><br><span class="line">CMD sh /usr/local/tomcat/apache-tomcat-8.5.61/bin/startup.sh &amp;&amp; tail -f /usr/local/tomcat/apache-tomcat-8.5.61/logs/catalina.out</span><br></pre></td></tr></table></figure>

<blockquote>
<p>docker build 生成镜像文件</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 由于文件命名是Dockerfile,无需指定-f参数</span></span><br><span class="line">docker build -t diy_tomcat .</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 后台启动容器,将tomcat的webapps和日志目录挂载到宿主机,启动后自动打印启动日志</span></span><br><span class="line">[root@ming diy_tomcat]# docker run -p 3344:8080 -v /home/diy_tomcat/webapps/:/usr/local/tomcat/apache-tomcat-8.5.61/webapps/ -v /home/diy_tomcat/logs/:/usr/local/tomcat/apache-tomcat-8.5.61/logs/ diy_tomcat </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 查看容器,容器正在运行</span></span><br><span class="line">[root@ming diy_tomcat]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE        COMMAND                  CREATED              STATUS              PORTS                    NAMES</span><br><span class="line">3134796152c3   diy_tomcat   "/bin/sh -c 'sh /usr…"   About a minute ago   Up About a minute   0.0.0.0:3344-&gt;8080/tcp   heuristic_kare</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.外网访问http://47.96.224.198:3344/,访问正常</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 查看宿主机挂载的目录是否挂载成功</span></span><br><span class="line">[root@ming webapps]# pwd</span><br><span class="line">/home/diy_tomcat/webapps</span><br><span class="line">[root@ming webapps]# ls</span><br><span class="line">balance  dev  docs  examples  host-manager  manager  ROOT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 以后，我们只需要将项目部署在宿主机的webapps目录下就可以啦</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo "1"&gt;/proc/sys/vm/drop_caches</span><br></pre></td></tr></table></figure>

<h4 id="9-5-不同操作系统的镜像"><a href="#9-5-不同操作系统的镜像" class="headerlink" title="9.5 不同操作系统的镜像"></a>9.5 不同操作系统的镜像</h4><p>使用镜像创建容器,该镜像必须与Docker宿主机系统架构一致.为了在不同的操作系统上使用相同的镜像,就必须为每个操作系统单独构建一个镜像.<br>但是Docker官方提供了一个Manifest列表.<br>当用户获取一个镜像时,Docker引擎会首先查找该镜像是否有manifest列表,如果有的话Docker引擎会按照Docker运行环境(系统及架构)查找出对应镜像.如果没有的话会直接获取镜像.</p>
<h5 id="9-5-1-查看manifest列表"><a href="#9-5-1-查看manifest列表" class="headerlink" title="9.5.1 查看manifest列表"></a>9.5.1 查看manifest列表</h5><p>使用<code>docker manifest inspect</code> 查看manifest列表.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@aliyun ~]# docker manifest inspect golang:alpine</span><br><span class="line">&#123;</span><br><span class="line">   "schemaVersion": 2,</span><br><span class="line">   "mediaType": "application/vnd.docker.distribution.manifest.list.v2+json",</span><br><span class="line">   "manifests": [</span><br><span class="line">      &#123;</span><br><span class="line">         "mediaType": "application/vnd.docker.distribution.manifest.v2+json",</span><br><span class="line">         "size": 1365,</span><br><span class="line">         "digest": "sha256:8474650232fca6807a8567151ee0a6bd2a54ea28cfc93f7824b42267ef4af693",</span><br><span class="line">         "platform": &#123;</span><br><span class="line">            "architecture": "amd64",</span><br><span class="line">            "os": "linux"</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         "mediaType": "application/vnd.docker.distribution.manifest.v2+json",</span><br><span class="line">         "size": 1365,</span><br><span class="line">         "digest": "sha256:53b31b66a1c02978ab537c4eacb242aebd48cc5bf59f1310d6e373a852140e2d",</span><br><span class="line">         "platform": &#123;</span><br><span class="line">            "architecture": "arm",</span><br><span class="line">            "os": "linux",</span><br><span class="line">            "variant": "v6"</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-发布自己的镜像"><a href="#10-发布自己的镜像" class="headerlink" title="10.发布自己的镜像"></a>10.发布自己的镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 首先需要创建DockerHub的账号</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 在命令行中先登录账户</span></span><br><span class="line">[root@ming ~]# docker login -u jinming8</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 将要发布的镜像tag成 用户名/镜像名，这一步至关重要</span></span><br><span class="line">[root@ming ~]# docker tag nginx jinming8/nginx:0.1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 执行push命令，发布到Dockhub</span></span><br><span class="line">[root@ming ~]# docker push jinming8/nginx:0.1</span><br><span class="line">The push refers to repository [docker.io/jinming8/nginx]</span><br><span class="line">4eaf0ea085df: Mounted from library/nginx </span><br><span class="line">2c7498eef94a: Mounted from library/nginx </span><br><span class="line">7d2b207c2679: Mounted from library/nginx </span><br><span class="line">5c4e5adc71a8: Mounted from library/nginx </span><br><span class="line">87c8a1d8f54f: Mounted from library/mysql </span><br><span class="line">0.1: digest: sha256:13e4551010728646aa7e1b1ac5313e04cf75d051fa441396832fcd6d600b5e71 size: 1362   # 发布成功</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 退出登录</span></span><br><span class="line">[root@ming ~]# docker logout</span><br><span class="line">Removing login credentials for https://index.docker.io/v1/</span><br></pre></td></tr></table></figure>

<h3 id="11-Docker网络"><a href="#11-Docker网络" class="headerlink" title="11. Docker网络"></a>11. Docker网络</h3><p>安装了docker之后,Docker默认使用桥接模式,会自动分配一个网卡docker0,我们可以通过以下命令查看:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">65835d31d2aa   bridge    bridge    local</span><br><span class="line">7855b7c8c192   host      host      local</span><br><span class="line">62e33b041284   none      null      local</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker有3种网络模式：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.bridge:桥接模式，docker默认的网络模式</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.host:与宿主机器共享网络</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.none:不使用网络</span></span><br></pre></td></tr></table></figure>

<p>如果想查看网络的详细信息,可以使用<code>docker network inspect ID</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker inspect bridge</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Name": "bridge",</span><br><span class="line">        "Id": "65835d31d2aae177b93753c41e7bcddc7a16bca5ba7203f37f15db0c30ed1d55",</span><br><span class="line">        "Created": "2021-12-13T11:35:03.449943083Z",</span><br><span class="line">        "Scope": "local",</span><br><span class="line">        "Driver": "bridge",</span><br><span class="line">        "EnableIPv6": false,</span><br><span class="line">        "IPAM": &#123;</span><br><span class="line">            "Driver": "default",</span><br><span class="line">            "Options": null,</span><br><span class="line">            "Config": [</span><br><span class="line">                &#123;</span><br><span class="line">                    "Subnet": "172.17.0.0/16",</span><br><span class="line">                    "Gateway": "172.17.0.1"</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "Internal": false,</span><br><span class="line">        "Attachable": false,</span><br><span class="line">        "Ingress": false,</span><br><span class="line">        "ConfigFrom": &#123;</span><br><span class="line">            "Network": ""</span><br><span class="line">        &#125;,</span><br><span class="line">        "ConfigOnly": false,</span><br><span class="line">        # 所有连接到该网桥的容器的信息</span><br><span class="line">        "Containers": &#123;</span><br><span class="line">            "0fde18a60470ab399cafdf9fc6d407fa125ac0fc7a1af9610649968e19c70fa7": &#123;</span><br><span class="line">                "Name": "mysql-test",</span><br><span class="line">                "EndpointID": "d6bf32b11b1f9b4a48a3794bfe2583bb522ac12159439359a6dcfc4ca433e2f0",</span><br><span class="line">                "MacAddress": "02:42:ac:11:00:02",</span><br><span class="line">                "IPv4Address": "172.17.0.2/16", # mysql容器的IP</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            "f1953dca10dbbb7ebb2b77693ed7fbcceba997ed533dff76ba63e9e08c53a863": &#123;</span><br><span class="line">                "Name": "tomcat",</span><br><span class="line">                "EndpointID": "b8cf305cf3bc697b10535263c13b9c30daca3b812a33ac29e021cab7b137059a",</span><br><span class="line">                "MacAddress": "02:42:ac:11:00:03",</span><br><span class="line">                "IPv4Address": "172.17.0.3/16", # tomcat容器的IP</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "Options": &#123;</span><br><span class="line">            "com.docker.network.bridge.default_bridge": "true",</span><br><span class="line">            "com.docker.network.bridge.enable_icc": "true",</span><br><span class="line">            "com.docker.network.bridge.enable_ip_masquerade": "true",</span><br><span class="line">            "com.docker.network.bridge.host_binding_ipv4": "0.0.0.0",</span><br><span class="line">            "com.docker.network.bridge.name": "docker0",</span><br><span class="line">            "com.docker.network.driver.mtu": "1500"</span><br><span class="line">        &#125;,</span><br><span class="line">        "Labels": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>桥接模式使用veth-pair的技术(一对虚拟设备接口,一端连着容器,一端连着docker0,只要一端收到数据,另外一端也会接受到相同的数据).<br>当宿主机与容器通信时,宿主机往docker0的设备接口发送数据,连接着docker0的容器端的设备接口也会收到相同的数据.<br>当容器与宿主机通信时,容器往容器的设备接口发送数据,连接着容器的docker0端设备接口也会收到相同的数据.<br>而容器的IP与docker0的IP会在同一个网段,可以相互通信.这就实现了容器间的通信.</p>
<h4 id="11-1-问题1：宿主机和容器能不能ping通？-✔"><a href="#11-1-问题1：宿主机和容器能不能ping通？-✔" class="headerlink" title="11.1 问题1：宿主机和容器能不能ping通？  ✔"></a>11.1 问题1：宿主机和容器能不能ping通？  ✔</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 查看宿主机器的ip addr</span></span><br><span class="line">[root@ming ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 00:16:3f:00:fd:98 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.16.47.149/20 brd 172.16.47.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 314901004sec preferred_lft 314901004sec</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN </span><br><span class="line">    link/ether 02:42:e7:4f:27:e0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 宿主机器上有3个网卡：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1. lo:本地回环地址</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. eth0:阿里云内网，ip=172.16.47.149</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. docker0:docker的网卡，只要我们安装了docker就会有这个网卡</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 启动一个tomcat容器</span></span><br><span class="line">[root@ming ~]# docker run -it --name tomcat1  tomcat /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 进入容器内查看ip</span></span><br><span class="line">root@1826a8cb702d:/usr/local/tomcat# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">332: eth0@if333: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器内有2个网卡：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1. lo:本地回环地址</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 332: eth0@if333:docker为容器分配的网卡，ip=172.17.0.2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 在容器内ping宿主机器的ip 172.16.47.149</span></span><br><span class="line">root@1826a8cb702d:/usr/local/tomcat# ping 172.16.47.149</span><br><span class="line">PING 172.16.47.149 (172.16.47.149) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.16.47.149: icmp_seq=1 ttl=64 time=0.079 ms</span><br><span class="line">64 bytes from 172.16.47.149: icmp_seq=2 ttl=64 time=0.075 ms</span><br><span class="line">64 bytes from 172.16.47.149: icmp_seq=3 ttl=64 time=0.077 ms</span><br><span class="line">64 bytes from 172.16.47.149: icmp_seq=4 ttl=64 time=0.077 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论1：在容器内是可以ping通宿主机器地址的</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. CTRL+P+Q退出容器，在宿主机查看ip addr</span></span><br><span class="line">[root@ming ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 00:16:3f:00:fd:98 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.16.47.149/20 brd 172.16.47.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 314900722sec preferred_lft 314900722sec</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP </span><br><span class="line">    link/ether 02:42:e7:4f:27:e0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">333: veth740bb55@if332: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP </span><br><span class="line">    link/ether 06:b3:9f:71:29:93 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 相比与启动容器tomcat之前，宿主机多了一个网卡333: veth740bb55@if332，而且我们发现，它与容器的内的网卡332: eth0@if333形成了一对。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6. 在宿主机内ping容器地址172.17.0.2</span></span><br><span class="line">[root@ming ~]# ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.059 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.066 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.064 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=4 ttl=64 time=0.084 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论2:宿主机是可以ping通容器内的ip的</span></span><br></pre></td></tr></table></figure>

<h4 id="11-2-问题2：两个容器直接能否直接ping通？-✔"><a href="#11-2-问题2：两个容器直接能否直接ping通？-✔" class="headerlink" title="11.2 问题2：两个容器直接能否直接ping通？ ✔"></a>11.2 问题2：两个容器直接能否直接ping通？ ✔</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.再次启动一个容器tomcat2，查看ip地址</span></span><br><span class="line">[root@ming ~]# docker run -it --name=tomcat2 tomcat /bin/bash</span><br><span class="line">root@9d1e83b5c4d6:/usr/local/tomcat# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">334: eth0@if335: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器内也是有2个网卡，一个本机回环地址，一个docker分配的网卡，tomcat2的ip=172.17.0.3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. tomcat2 能否ping通 tomcat1 ？ </span></span><br><span class="line">root@9d1e83b5c4d6:/usr/local/tomcat# ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.099 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.087 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.085 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=4 ttl=64 time=0.089 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果肯定是可以的，因为从ip地址可以看出，它们属于同一个网段。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 进入到tomcat1容器，ping tomcat2的ip</span></span><br><span class="line">[root@ming ~]# docker attach 1826a8cb702d</span><br><span class="line">root@1826a8cb702d:/usr/local/tomcat# ping 172.17.0.3</span><br><span class="line">PING 172.17.0.3 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.3: icmp_seq=1 ttl=64 time=0.075 ms</span><br><span class="line">64 bytes from 172.17.0.3: icmp_seq=2 ttl=64 time=0.090 ms</span><br><span class="line">64 bytes from 172.17.0.3: icmp_seq=3 ttl=64 time=0.085 ms</span><br><span class="line">64 bytes from 172.17.0.3: icmp_seq=4 ttl=64 time=0.089 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再次验证。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论：两个容器之间也是可以相互ping通的。虽然两个容器直接能ping通，但两个容器间却不是直接相连接的。它们通过veth-pair与docker0相连，docker0这个桥接起了作用</span></span><br></pre></td></tr></table></figure>

<h4 id="11-3-能否通过容器的name来连接？-×-–link-✔"><a href="#11-3-能否通过容器的name来连接？-×-–link-✔" class="headerlink" title="11.3 能否通过容器的name来连接？ ×(–link ✔)"></a>11.3 能否通过容器的name来连接？ ×(–link ✔)</h4><p>默认容器之间的通信使用的是IP的形式,如果想使用容器的名字来进行通信,需要在创建容器的时候指定–link参数.<br>需要注意的是–link参数是单向的.<br>–link参数实际上是在容器的/etc/hosts文件中增加了一个host的映射,当通过名称访问时,会被映射成对应的IP地址.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 进入到tomcat1容器，直接ping tomcat2容器的名字</span></span><br><span class="line">root@1826a8cb702d:/usr/local/tomcat# ping tomcat2</span><br><span class="line">ping: tomcat2: Name or service not known</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 不能直接通过容器名称来连接</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 重新启动容器tomcat3，指定--link 连接tomcat2</span></span><br><span class="line">[root@ming ~]# docker run -it --name tomcat3 --link tomcat2 tomcat /bin/bash </span><br><span class="line">root@0ded9ce6d825:/usr/local/tomcat# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">338: eth0@if339: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意，这里tomcat3的ip=172.17.0.2，好像和tomcat1的ip相同，但是我这里是把tomcat1容器退出了的</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 在tomcat3容器内直接ping tomcat2</span></span><br><span class="line">root@0ded9ce6d825:/usr/local/tomcat# ping tomcat2</span><br><span class="line">PING tomcat2 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat2 (172.17.0.3): icmp_seq=1 ttl=64 time=0.094 ms</span><br><span class="line">64 bytes from tomcat2 (172.17.0.3): icmp_seq=2 ttl=64 time=0.084 ms</span><br><span class="line">64 bytes from tomcat2 (172.17.0.3): icmp_seq=3 ttl=64 time=0.085 ms</span><br><span class="line">64 bytes from tomcat2 (172.17.0.3): icmp_seq=4 ttl=64 time=0.084 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论1:在启动容器的时候，使用--link 参数指定容器，可以与指定的容器通过名称连接</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 进入容器tomcat2，ping tomcat3</span></span><br><span class="line">[root@ming ~]# docker attach 9d1e83b5c4d6</span><br><span class="line">root@9d1e83b5c4d6:/usr/local/tomcat# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">334: eth0@if335: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">root@9d1e83b5c4d6:/usr/local/tomcat# ping tomcat3</span><br><span class="line">ping: tomcat3: Name or service not known</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论2:tomcat2是不能ping通tomcat3的，说明tomcat3容器启动的时候指定的--link参数是单向的。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 进入tomcat3容器，查看/etc/hosts文件</span></span><br><span class="line">[root@ming ~]# docker attach 0ded9ce6d825</span><br><span class="line">root@0ded9ce6d825:/usr/local/tomcat# cat /etc/hosts</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	tomcat2 9d1e83b5c4d6</span><br><span class="line">172.17.0.2	0ded9ce6d825</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论3：我们惊奇的发现，所谓的tomcat3启动时指定的--link参数，只是修改了tomcat的hosts文件，当tomcat3访问tomcat2的时候，跳转到172.17.0.3(也就是tomcat的ip地址)</span></span><br></pre></td></tr></table></figure>

<p>虽然–link能使用容器名称来连接，但这种做法是过时的，更好的方法是使用自定义网络。</p>
<h4 id="11-4-自定义网络"><a href="#11-4-自定义网络" class="headerlink" title="11.4 自定义网络"></a>11.4 自定义网络</h4><blockquote>
<p>自定义一个网络</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 创建网络，指定网关和子网掩码</span></span><br><span class="line">[root@ming ~]# docker network create --gateway 192.168.0.1 --subnet 192.168.0.0/16 mynet </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查看创建的网络</span></span><br><span class="line">[root@ming ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">1cd4dcbb6871   bridge    bridge    local</span><br><span class="line">937119faf618   host      host      local</span><br><span class="line">805e98b29181   mynet     bridge    local</span><br><span class="line">5f780b566b6c   none      null      local</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 启动容器的时候指定网络</span></span><br><span class="line">[root@ming ~]# docker run -it --name tomcat1 --network mynet tomcat /bin/bash</span><br><span class="line">root@a8d9dd3ce963:/usr/local/tomcat# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">341: eth0@if342: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:c0:a8:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 192.168.0.2/16 brd 192.168.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta"> #</span><span class="bash"> 容器启动后的ip=192.168.0.2,是我们自定义的网络mynet</span></span><br><span class="line"> </span><br><span class="line"><span class="meta"> #</span><span class="bash"> 4. 查看mynet的详细信息</span></span><br><span class="line"> </span><br><span class="line">[root@ming ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Name": "mynet",</span><br><span class="line">        "Id": "805e98b29181a303950c9f3267587e6ea27c2df3728a0723e4f16acb43add392",</span><br><span class="line">        "Created": "2021-01-05T19:12:36.296644818+08:00",</span><br><span class="line">        "Scope": "local",</span><br><span class="line">        "Driver": "bridge",</span><br><span class="line">        "EnableIPv6": false,</span><br><span class="line">        "IPAM": &#123;</span><br><span class="line">            "Driver": "default",</span><br><span class="line">            "Options": &#123;&#125;,</span><br><span class="line">            "Config": [</span><br><span class="line">                &#123;</span><br><span class="line">                    "Subnet": "192.168.0.0/16", # 我们设置的子网</span><br><span class="line">                    "Gateway": "192.168.0.1"    # 我们设置的网关</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "Internal": false,</span><br><span class="line">        "Attachable": false,</span><br><span class="line">        "Ingress": false,</span><br><span class="line">        "ConfigFrom": &#123;</span><br><span class="line">            "Network": ""</span><br><span class="line">        &#125;,</span><br><span class="line">        "ConfigOnly": false,</span><br><span class="line">        "Containers": &#123;  # 此网络内的容器信息</span><br><span class="line">            "a8d9dd3ce9633968957a5d1487bbf85716985f97ed6cf4f2b9a78c47d2c3f67d": &#123;</span><br><span class="line">                "Name": "tomcat1",</span><br><span class="line">                "EndpointID": "f1bbab5f9d330f62f17ef2076dd09d00a124d14d5ce8c3658d8e6459215c4e19",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:02",</span><br><span class="line">                "IPv4Address": "192.168.0.2/16",  # tomcat1容器的ip</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "Options": &#123;&#125;,</span><br><span class="line">        "Labels": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 启动容器tomcat2，查看ip，并通过容器名称连接tomcat1</span></span><br><span class="line">[root@ming ~]# docker run -it --name tomcat2 --net mynet tomcat /bin/bash</span><br><span class="line">root@bf9e41e968ae:/usr/local/tomcat# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">343: eth0@if344: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:c0:a8:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 192.168.0.3/16 brd 192.168.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">root@bf9e41e968ae:/usr/local/tomcat# ping tomcat1</span><br><span class="line">PING tomcat1 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat1.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.101 ms</span><br><span class="line">64 bytes from tomcat1.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.083 ms</span><br><span class="line">64 bytes from tomcat1.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.098 ms</span><br><span class="line">64 bytes from tomcat1.mynet (192.168.0.2): icmp_seq=4 ttl=64 time=0.088 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论1:通过自定义网络是能通过容器名称进行连接的。</span></span><br></pre></td></tr></table></figure>

<h4 id="11-5-网络互联"><a href="#11-5-网络互联" class="headerlink" title="11.5 网络互联"></a>11.5 网络互联</h4><p>上面tomcat1和tomcat2已经连接在mynet网络下了，那么连接在docker0的容器，能否访问mynet网络下的容器呢？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 使用默认的docker0启动一个容器tomcat3</span></span><br><span class="line">[root@ming ~]# docker run -it --name tomcat3 tomcat /bin/bash</span><br><span class="line">root@bac489a3beb3:/usr/local/tomcat# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">345: eth0@if346: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 使用tomcat3连接mynet网络下的tomcat2</span></span><br><span class="line">root@bac489a3beb3:/usr/local/tomcat# ping tomcat2</span><br><span class="line">ping: tomcat2: Name or service not known</span><br><span class="line">root@bac489a3beb3:/usr/local/tomcat# ping 192.168.0.3</span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 无论是通过ip，还是通过容器名称，都无法连接。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mynet和docker0的网段不同</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 使用docker network connect让docker0下的tomcat3容器连接到mynet网络</span></span><br><span class="line">[root@ming ~]# docker network connect mynet tomcat3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 查看mynet网络的详细信息</span></span><br><span class="line">[root@ming ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Name": "mynet",</span><br><span class="line">        "Id": "805e98b29181a303950c9f3267587e6ea27c2df3728a0723e4f16acb43add392",</span><br><span class="line">        "Created": "2021-01-05T19:12:36.296644818+08:00",</span><br><span class="line">        "Scope": "local",</span><br><span class="line">        "Driver": "bridge",</span><br><span class="line">        "EnableIPv6": false,</span><br><span class="line">        "IPAM": &#123;</span><br><span class="line">            "Driver": "default",</span><br><span class="line">            "Options": &#123;&#125;,</span><br><span class="line">            "Config": [</span><br><span class="line">                &#123;</span><br><span class="line">                    "Subnet": "192.168.0.0/16",</span><br><span class="line">                    "Gateway": "192.168.0.1"</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "Internal": false,</span><br><span class="line">        "Attachable": false,</span><br><span class="line">        "Ingress": false,</span><br><span class="line">        "ConfigFrom": &#123;</span><br><span class="line">            "Network": ""</span><br><span class="line">        &#125;,</span><br><span class="line">        "ConfigOnly": false,</span><br><span class="line">        "Containers": &#123;</span><br><span class="line">            "a8d9dd3ce9633968957a5d1487bbf85716985f97ed6cf4f2b9a78c47d2c3f67d": &#123;</span><br><span class="line">                "Name": "tomcat1",</span><br><span class="line">                "EndpointID": "f1bbab5f9d330f62f17ef2076dd09d00a124d14d5ce8c3658d8e6459215c4e19",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:02",</span><br><span class="line">                "IPv4Address": "192.168.0.2/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            "bf9e41e968aeccc9ccd0ecc3efc60c1d38b550ea783dbc530b68eba9b7952d5c": &#123;</span><br><span class="line">                "Name": "tomcat2",</span><br><span class="line">                "EndpointID": "f016fc90361535f9e08c0ad4dfd92bc630c83a88704680231e33a4bbd201f15a",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:03",</span><br><span class="line">                "IPv4Address": "192.168.0.3/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            "f1933b52fa5559c60890e2a223cb118ff2290a5f0ff4966d1cffac28c280c439": &#123;</span><br><span class="line">                "Name": "tomcat3",  # mynet网络下已经有了tomcat3的容器</span><br><span class="line">                "EndpointID": "48ce720242696f70d6ae7051a8754d56b30ae2d3bc08b82761822eeca25ddebf",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:04",</span><br><span class="line">                "IPv4Address": "192.168.0.4/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "Options": &#123;&#125;,</span><br><span class="line">        "Labels": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 查看tomcat3容器的ip</span></span><br><span class="line">root@f1933b52fa55:/usr/local/tomcat# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">347: eth0@if348: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">349: eth1@if350: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:c0:a8:00:04 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 192.168.0.4/16 brd 192.168.255.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta"> #</span><span class="bash"> 可以看到，tomcat有2个ip地址</span></span><br><span class="line"><span class="meta"> #</span><span class="bash">          172.17.0.2  docker0网卡的</span></span><br><span class="line"><span class="meta"> #</span><span class="bash">          192.168.0.4  mynet网卡的</span></span><br></pre></td></tr></table></figure>

<h4 id="11-6-查看容器IP"><a href="#11-6-查看容器IP" class="headerlink" title="11.6 查看容器IP"></a>11.6 查看容器IP</h4><h5 id="11-6-1-在容器内查看"><a href="#11-6-1-在容器内查看" class="headerlink" title="11.6.1 在容器内查看"></a>11.6.1 在容器内查看</h5><p>如果在容器内查看容器IP,可以查看/etc/hosts文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@f1953dca10db:/etc# cat hosts</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	f1953dca10db</span><br></pre></td></tr></table></figure>

<h5 id="11-6-2-在容器外查看"><a href="#11-6-2-在容器外查看" class="headerlink" title="11.6.2 在容器外查看"></a>11.6.2 在容器外查看</h5><p>如果在容器外查看容器IP,可以使用docker inspect 容器id｜name 查看容器的信息,其中有一个字段IPAddress就是容器IP<br>或者可以添加–format 只获取容器信息的IPAddress字段</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -f 表示format</span></span><br><span class="line">docker inspect tomcat -f '&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;'</span><br></pre></td></tr></table></figure>

<h5 id="11-6-3-获取所有容器名称和IP"><a href="#11-6-3-获取所有容器名称和IP" class="headerlink" title="11.6.3 获取所有容器名称和IP"></a>11.6.3 获取所有容器名称和IP</h5><p>-f 参数必须使用单引号</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect -f '&#123;&#123;.Name&#125;&#125; - &#123;&#123;.NetworkSettings.IPAddress&#125;&#125;' $(docker ps -aq)</span><br></pre></td></tr></table></figure>

<p>或者可以通过网桥查看所有连接到该网桥的容器的信息:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">  查看所有的网桥信息</span></span><br><span class="line">➜  ~ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">65835d31d2aa   bridge    bridge    local</span><br><span class="line">7855b7c8c192   host      host      local</span><br><span class="line">62e33b041284   none      null      local</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看bridge网桥的信息</span></span><br><span class="line">➜  ~ docker inspect bridge</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Name": "bridge",</span><br><span class="line">        "Id": "65835d31d2aae177b93753c41e7bcddc7a16bca5ba7203f37f15db0c30ed1d55",</span><br><span class="line">        "Created": "2021-12-13T11:35:03.449943083Z",</span><br><span class="line">        "Scope": "local",</span><br><span class="line">        "Driver": "bridge",</span><br><span class="line">        "EnableIPv6": false,</span><br><span class="line">        "IPAM": &#123;</span><br><span class="line">            "Driver": "default",</span><br><span class="line">            "Options": null,</span><br><span class="line">            "Config": [</span><br><span class="line">                &#123;</span><br><span class="line">                    "Subnet": "172.17.0.0/16",</span><br><span class="line">                    "Gateway": "172.17.0.1"</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "Internal": false,</span><br><span class="line">        "Attachable": false,</span><br><span class="line">        "Ingress": false,</span><br><span class="line">        "ConfigFrom": &#123;</span><br><span class="line">            "Network": ""</span><br><span class="line">        &#125;,</span><br><span class="line">        "ConfigOnly": false,</span><br><span class="line">        # 所有连接到该网桥的容器的信息</span><br><span class="line">        "Containers": &#123;</span><br><span class="line">            "0fde18a60470ab399cafdf9fc6d407fa125ac0fc7a1af9610649968e19c70fa7": &#123;</span><br><span class="line">                "Name": "mysql-test",</span><br><span class="line">                "EndpointID": "d6bf32b11b1f9b4a48a3794bfe2583bb522ac12159439359a6dcfc4ca433e2f0",</span><br><span class="line">                "MacAddress": "02:42:ac:11:00:02",</span><br><span class="line">                "IPv4Address": "172.17.0.2/16", # mysql容器的IP</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            "f1953dca10dbbb7ebb2b77693ed7fbcceba997ed533dff76ba63e9e08c53a863": &#123;</span><br><span class="line">                "Name": "tomcat",</span><br><span class="line">                "EndpointID": "b8cf305cf3bc697b10535263c13b9c30daca3b812a33ac29e021cab7b137059a",</span><br><span class="line">                "MacAddress": "02:42:ac:11:00:03",</span><br><span class="line">                "IPv4Address": "172.17.0.3/16", # tomcat容器的IP</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "Options": &#123;</span><br><span class="line">            "com.docker.network.bridge.default_bridge": "true",</span><br><span class="line">            "com.docker.network.bridge.enable_icc": "true",</span><br><span class="line">            "com.docker.network.bridge.enable_ip_masquerade": "true",</span><br><span class="line">            "com.docker.network.bridge.host_binding_ipv4": "0.0.0.0",</span><br><span class="line">            "com.docker.network.bridge.name": "docker0",</span><br><span class="line">            "com.docker.network.driver.mtu": "1500"</span><br><span class="line">        &#125;,</span><br><span class="line">        "Labels": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="11-7-Macos的网络问题"><a href="#11-7-Macos的网络问题" class="headerlink" title="11.7 Macos的网络问题"></a>11.7 Macos的网络问题</h4><p><a href="https://www.haoyizebo.com/posts/fd0b9bd8/#docker-connector" target="_blank" rel="noopener">Docker For Mac的网络问题及解决办法</a><br><a href="https://docs.docker.com/desktop/mac/networking/" target="_blank" rel="noopener">Docker官方对于MacOs网络的描述</a></p>
<p>Docker是利用Linux的Namespace和Cgroups来实现资源的隔离和限制,容器共享宿主机内核.所以Mac本身没法运行Docker容器.<br>Mac是在Macos上跑了一个Linux虚拟机,然后在虚拟机上跑的Docker.<br>这就导致Mac上没有Docker0的网桥,Mac上也不能直接ping通容器的IP.</p>
<p>解决方法(docker-connector):<br>1.(Macos端):在Mac上安装docker-connector,并修改docker-connector.conf添加bridge的IP<br>Mac上使用homebrew安装,安装后的默认路径是在/opt/homebrew</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install wenjunxiao/brew/docker-connector</span><br></pre></td></tr></table></figure>

<p>修改/opt/homebrew/etc/docker-connector.conf配置文件,添加需要访问容器的bridge:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 添加docker默认的bridge</span><br><span class="line">route 172.17.0.0/16</span><br></pre></td></tr></table></figure>

<p>启动docker-connector服务:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services start docker-connector</span><br></pre></td></tr></table></figure>

<p>2.(Docker端):拉取docker-connector镜像,并创建容器:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d --restart always --net host --cap-add NET_ADMIN --name connector wenjunxiao/mac-docker-connector</span><br></pre></td></tr></table></figure>

<p>根据以上的配置,Mac宿主机就能ping通容器内IP了.</p>
<h4 id="11-8-查看端口映射配置"><a href="#11-8-查看端口映射配置" class="headerlink" title="11.8 查看端口映射配置"></a>11.8 查看端口映射配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看tomcat容器所有的端口映射</span></span><br><span class="line">➜  ~ docker port tomcat</span><br><span class="line">8080/tcp -&gt; 0.0.0.0:8080</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看tomcat容器8080端口的映射</span></span><br><span class="line">➜  ~ docker port tomcat 8080</span><br><span class="line">0.0.0.0:8080</span><br></pre></td></tr></table></figure>

<h3 id="12-Docker工具安装"><a href="#12-Docker工具安装" class="headerlink" title="12.Docker工具安装"></a>12.Docker工具安装</h3><h5 id="12-1-vim"><a href="#12-1-vim" class="headerlink" title="12.1 vim"></a>12.1 vim</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install vim</span><br></pre></td></tr></table></figure>

<p>或者使用yum安装:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y vim</span><br></pre></td></tr></table></figure>

<h5 id="12-2-ping"><a href="#12-2-ping" class="headerlink" title="12.2 ping"></a>12.2 ping</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install iputils-ping</span><br></pre></td></tr></table></figure>

<h5 id="12-3-ifconfig"><a href="#12-3-ifconfig" class="headerlink" title="12.3 ifconfig"></a>12.3 ifconfig</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install net-tools</span><br></pre></td></tr></table></figure>

<h5 id="12-4-yum"><a href="#12-4-yum" class="headerlink" title="12.4 yum"></a>12.4 yum</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://yum.baseurl.org/download/3.2/yum-3.2.28.tar.gz</span><br><span class="line">tar xvf yum-3.2.28.tar.gz</span><br><span class="line">cd yum-3.2.28</span><br></pre></td></tr></table></figure>

<h3 id="13-常用容器"><a href="#13-常用容器" class="headerlink" title="13.常用容器"></a>13.常用容器</h3><h4 id="13-1-Mysql"><a href="#13-1-Mysql" class="headerlink" title="13.1 Mysql"></a>13.1 Mysql</h4><p>使用别人镜像的时候,很重要的一点是到Docker Hub上查找镜像并查看镜像的使用方法.<br>主要是关于数据持久化或配置备份相关的目录,只有根据镜像的说明文档才知道它存放的路径在哪里.</p>
<p>后台启动mysql容器,挂载到docker的数据款mysqldata上,映射宿主机的3306端口,在macos上需要指定platform<br>-e参数是环境变量,指定mysql启动时root的密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mysql -v mysqldata:/var/lib/mysql -p 3306:3306 --platform linux/amd64 -e MYSQL_ROOT_PASSWORD=root mysql</span><br></pre></td></tr></table></figure>

<p>容器启动之后查看mysql容器的信息,这里只列出基本信息和数据卷信息:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">➜  bin docker inspect mysql</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Id": "a5a6aa84ab7091059fae4f0504faa3cd59c25b607dab6ffe0c5f3f9b0678d4c7",</span><br><span class="line">        "Created": "2021-12-15T13:55:43.516570797Z",</span><br><span class="line">        "Path": "docker-entrypoint.sh",</span><br><span class="line">        "Args": [</span><br><span class="line">            "mysqld"</span><br><span class="line">        ],</span><br><span class="line">        "State": &#123;</span><br><span class="line">            "Status": "running",</span><br><span class="line">            "Running": true,</span><br><span class="line">            "Paused": false,</span><br><span class="line">            "Restarting": false,</span><br><span class="line">            "OOMKilled": false,</span><br><span class="line">            "Dead": false,</span><br><span class="line">            "Pid": 3185,</span><br><span class="line">            "ExitCode": 0,</span><br><span class="line">            "Error": "",</span><br><span class="line">            "StartedAt": "2021-12-15T13:55:43.73619438Z",</span><br><span class="line">            "FinishedAt": "0001-01-01T00:00:00Z"</span><br><span class="line">        &#125;,</span><br><span class="line">        "Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "mysqldata", # docker run时指定的数据卷的名称</span><br><span class="line">                "Source": "/var/lib/docker/volumes/mysqldata/_data", # 挂载在宿主机上的这个目录</span><br><span class="line">                "Destination": "/var/lib/mysql",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "z",</span><br><span class="line">                "RW": true,  # 具有可读可写的权限</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="13-2-tomcat"><a href="#13-2-tomcat" class="headerlink" title="13.2 tomcat"></a>13.2 tomcat</h4><p>直接使用docker run启动一个容器,当本地没有tomcat的镜像时,会直接到远程仓库中拉取.<br>将容器内的webapps目录挂载到宿主机的/usr/local/apps目录中,以后项目只需要部署在宿主机的/usr/local/apps目录下.<br>将容器内的conf目录挂载到宿主机的/usr/local/confs目录中,以后tomcat的配置文件只需要修改/usr/local/confs目录下的配置文件.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name tomcat -p 8080:8080 -v /usr/local/apps:/usr/local/tomcat/webapps -v /usr/local/confs :/usr/local/tomcat/conf tomcat:latest</span><br></pre></td></tr></table></figure>

<p>此时,通过<code>宿主机IP:端口</code>是访问不到tomcat的.<br>查看容器内的webapps目录,发现其目录下是空的.同时发现有一个webapps.dist的目录,我们需要将webapps.dist目录下的所有文件移动或复制到webapps目录下,才可以通过外网访问.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 移动webapps.dist下的所有文件到webapps</span></span><br><span class="line">mv webapps.dist/* webapps/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制webapps.dist下的所有文件到webapps</span></span><br><span class="line">cp -r webapps.dist/* webapps/</span><br></pre></td></tr></table></figure>

<p>完成复制的操作后,需要查看tomcat的启动日志,是否有重新加载了webapps的目录下的文件,如果还是加载webapps.dist目录的话,需要重启tomcat服务器.</p>
<p>关于修改tomcat的配置文件,如果修改的是tomcat不能重加载的配置,我们需要重新运行一个容器来修改tomcat的配置.<br>假设我们将tomcat的配置文件已经挂载到了宿主机上的/usr/local/confs/server.xml下,修改server.xml的tomcat的端口8080-&gt;8081<br>此时查看tomcat的日志,发现tomcat的端口还是8080,而不是8081,这是因为tomcat不能加载到tomcat端口改变的这个配置.<br>重启一下tomcat容器,查看日志如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">18-Dec-2021 13:39:56.343 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [&quot;http-nio-8081&quot;]</span><br><span class="line">18-Dec-2021 13:39:56.427 INFO [main] org.apache.catalina.startup.Catalina.load Server initialization in [1668] milliseconds</span><br><span class="line">18-Dec-2021 13:39:56.589 INFO [main] org.apache.catalina.core.StandardService.startInternal Starting service [Catalina]</span><br><span class="line">18-Dec-2021 13:39:56.589 INFO [main] org.apache.catalina.core.StandardEngine.startInternal Starting Servlet engine: [Apache Tomcat/10.0.14]</span><br><span class="line">18-Dec-2021 13:39:56.609 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/usr/local/tomcat/webapps/docs]</span><br></pre></td></tr></table></figure>

<p>日志显示,当前容器内的tomcat已经监听8081端口,宿主机上的8080映射容器内的8081端口.<br>但是当我们使用外网访问8080端口的时候,却访问不到.<br>此时,我们退出tomcat容器,在宿主机上查看当前运行的tomcat容器信息:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@aliyun ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND             CREATED          STATUS         PORTS                    NAMES</span><br><span class="line">7b25deacf086   tomcat    "catalina.sh run"   44 minutes ago   Up 7 minutes   0.0.0.0:8080-&gt;8080/tcp   tomcat</span><br></pre></td></tr></table></figure>

<p>我们可以发现,即使容器内的tomcat已经运行在8081端口,但是这个容器启动的时候,也就是执行docker run命令的时候,就已经指定了<br>-p 8080:8080,即使容器内的tomcat修改了端口,这个映射没有修改,也无法通过8081端口访问到tomcat.<br>此时,我们可以重新启动一个容器,使用原来的webapps和confs,修改端口映射为宿主机8080-&gt;容器8081</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name tomcat1 -p 8080:8081 -v /usr/local/apps:/usr/local/tomcat/webapps -v /usr/local/confs:/usr/local/tomcat/conf tomcat</span><br></pre></td></tr></table></figure>

<p>此时,查看启动的容器:<br>端口映射已经修改为8080-&gt;8081,而webapps和confs因为之前已经被挂载到了宿主机持久化了,再次启动一个新的容器的时候挂载的数据和原来的一致,只是端口的映射修改了.<br>此时,通过外网访问8080端口,能正常访问到容器内的8081端口.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@aliyun _data]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND             CREATED         STATUS         PORTS                              NAMES</span><br><span class="line">6b2fc0243d5b   tomcat    "catalina.sh run"   3 minutes ago   Up 3 minutes   8080/tcp, 0.0.0.0:8080-&gt;8081/tcp   tomcat1</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        
      
        <div id="reward-container">
  <div>一毛也是爱~</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
        
      
      <div style="display: inline-block">
        <img src="/images/wechatpay.jpg" alt="Kim.Zhang 微信支付">
        <p>微信支付</p>
      </div>

  </div>
</div>

      

      <footer class="post-footer">

        
  <div class="post-widgets">
    <div class="social-share">
      
      
        <div id="needsharebutton-postbottom">
          <span class="btn">
            <i class="fa fa-share-alt" aria-hidden="true"></i>
          </span>
        </div>
      
    </div>
  
  </div>

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2021/11/21/Spring Cloud/Spring Cloud/" rel="next" title="">
                  <i class="fa fa-chevron-left"></i> 
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2021/11/21/Redis/redis/" rel="prev" title="">
                   <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/1.jpg"
      alt="Kim.Zhang">
  <p class="site-author-name" itemprop="name">Kim.Zhang</p>
  <div class="site-description motion-element" itemprop="description">且行且珍惜</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">94</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span>
        
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:woshizhangjinming@vip.qq.com" title="E-Mail &rarr; mailto:woshizhangjinming@vip.qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://weibo.com/6196561949" title="Weibo &rarr; https://weibo.com/6196561949" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
    
  </div>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Docker简介"><span class="nav-number">1.</span> <span class="nav-text">1. Docker简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-基本概念"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 基本概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-安装Docker"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 安装Docker</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-阿里云镜像加速器"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 阿里云镜像加速器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-docerk-run-流程"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 docerk run 流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-底层原理"><span class="nav-number">1.5.</span> <span class="nav-text">1.5 底层原理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-镜像的基本命令"><span class="nav-number">2.</span> <span class="nav-text">2.镜像的基本命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-查看版本"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 查看版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-查看镜像"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 查看镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-搜索镜像"><span class="nav-number">2.3.</span> <span class="nav-text">2.2 搜索镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-下载镜像"><span class="nav-number">2.4.</span> <span class="nav-text">2.3 下载镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-删除镜像"><span class="nav-number">2.5.</span> <span class="nav-text">2.4 删除镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-导出镜像"><span class="nav-number">2.6.</span> <span class="nav-text">2.5 导出镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-导入镜像"><span class="nav-number">2.7.</span> <span class="nav-text">2.6 导入镜像</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-容器的基本命令"><span class="nav-number">3.</span> <span class="nav-text">3.容器的基本命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-创建容器并启动"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 创建容器并启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-查看容器"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 查看容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-退出容器"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 退出容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-删除容器"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 删除容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-启动和停止容器"><span class="nav-number">3.5.</span> <span class="nav-text">3.5 启动和停止容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-查看容器日志"><span class="nav-number">3.6.</span> <span class="nav-text">3.6 查看容器日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-7-导出容器"><span class="nav-number">3.7.</span> <span class="nav-text">3.7 导出容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-8-导入容器"><span class="nav-number">3.8.</span> <span class="nav-text">3.8 导入容器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-常用其他命令"><span class="nav-number">4.</span> <span class="nav-text">4.常用其他命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-后台启动容器"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 后台启动容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-查看日志"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 查看日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-查看容器中进程的信息"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 查看容器中进程的信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-查看镜像的元数据"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 查看镜像的元数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-进入当前正在运行的容器"><span class="nav-number">4.5.</span> <span class="nav-text">4.5 进入当前正在运行的容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-6-从容器内拷贝文件到主机上"><span class="nav-number">4.6.</span> <span class="nav-text">4.6 从容器内拷贝文件到主机上</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-命令小结"><span class="nav-number">5.</span> <span class="nav-text">5.命令小结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-小实战"><span class="nav-number">6.</span> <span class="nav-text">6. 小实战</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-部署nginx"><span class="nav-number">6.1.</span> <span class="nav-text">6.1 部署nginx</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-部署tomcat"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 部署tomcat</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-提交镜像"><span class="nav-number">7.</span> <span class="nav-text">7.提交镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-容器数据卷"><span class="nav-number">8.</span> <span class="nav-text">8.容器数据卷</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1-部署mysql"><span class="nav-number">8.1.</span> <span class="nav-text">8.1 部署mysql</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-具名挂载和匿名挂载"><span class="nav-number">8.2.</span> <span class="nav-text">8.2 具名挂载和匿名挂载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-权限"><span class="nav-number">8.3.</span> <span class="nav-text">8.3 权限</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-多个容器挂载同一个目录"><span class="nav-number">8.4.</span> <span class="nav-text">8.4 多个容器挂载同一个目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-5-Macos数据卷挂载目录"><span class="nav-number">8.5.</span> <span class="nav-text">8.5 Macos数据卷挂载目录</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-Dockfile"><span class="nav-number">9.</span> <span class="nav-text">9.Dockfile</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-1-制作Dockefile"><span class="nav-number">9.1.</span> <span class="nav-text">9.1 制作Dockefile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-2-Dockfile指令"><span class="nav-number">9.2.</span> <span class="nav-text">9.2 Dockfile指令</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-1-FROM"><span class="nav-number">9.2.1.</span> <span class="nav-text">9.2.1 FROM</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-2-RUN"><span class="nav-number">9.2.2.</span> <span class="nav-text">9.2.2 RUN</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-3-EXPOSE"><span class="nav-number">9.2.3.</span> <span class="nav-text">9.2.3 EXPOSE</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-4-WORKDIR"><span class="nav-number">9.2.4.</span> <span class="nav-text">9.2.4 WORKDIR</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-5-COPY"><span class="nav-number">9.2.5.</span> <span class="nav-text">9.2.5 COPY</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-6-ADD"><span class="nav-number">9.2.6.</span> <span class="nav-text">9.2.6 ADD</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-7-VOLUME"><span class="nav-number">9.2.7.</span> <span class="nav-text">9.2.7 VOLUME</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-8-EMV"><span class="nav-number">9.2.8.</span> <span class="nav-text">9.2.8 EMV</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-9-CMD"><span class="nav-number">9.2.9.</span> <span class="nav-text">9.2.9 CMD</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-10-ENTRYPOINT"><span class="nav-number">9.2.10.</span> <span class="nav-text">9.2.10 ENTRYPOINT</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-11-CMD-ENTRYPOINT区别"><span class="nav-number">9.2.11.</span> <span class="nav-text">9.2.11 CMD|ENTRYPOINT区别</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-12-HEALTHCHECK"><span class="nav-number">9.2.12.</span> <span class="nav-text">9.2.12 HEALTHCHECK</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-2-13-USER"><span class="nav-number">9.2.13.</span> <span class="nav-text">9.2.13 USER</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-查看构建过程"><span class="nav-number">9.3.</span> <span class="nav-text">9.3 查看构建过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-4-制作tomcat的Dockfile"><span class="nav-number">9.4.</span> <span class="nav-text">9.4 制作tomcat的Dockfile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-5-不同操作系统的镜像"><span class="nav-number">9.5.</span> <span class="nav-text">9.5 不同操作系统的镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#9-5-1-查看manifest列表"><span class="nav-number">9.5.1.</span> <span class="nav-text">9.5.1 查看manifest列表</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-发布自己的镜像"><span class="nav-number">10.</span> <span class="nav-text">10.发布自己的镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-Docker网络"><span class="nav-number">11.</span> <span class="nav-text">11. Docker网络</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#11-1-问题1：宿主机和容器能不能ping通？-✔"><span class="nav-number">11.1.</span> <span class="nav-text">11.1 问题1：宿主机和容器能不能ping通？  ✔</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-2-问题2：两个容器直接能否直接ping通？-✔"><span class="nav-number">11.2.</span> <span class="nav-text">11.2 问题2：两个容器直接能否直接ping通？ ✔</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-3-能否通过容器的name来连接？-×-–link-✔"><span class="nav-number">11.3.</span> <span class="nav-text">11.3 能否通过容器的name来连接？ ×(–link ✔)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-4-自定义网络"><span class="nav-number">11.4.</span> <span class="nav-text">11.4 自定义网络</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-5-网络互联"><span class="nav-number">11.5.</span> <span class="nav-text">11.5 网络互联</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-6-查看容器IP"><span class="nav-number">11.6.</span> <span class="nav-text">11.6 查看容器IP</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#11-6-1-在容器内查看"><span class="nav-number">11.6.1.</span> <span class="nav-text">11.6.1 在容器内查看</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-6-2-在容器外查看"><span class="nav-number">11.6.2.</span> <span class="nav-text">11.6.2 在容器外查看</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-6-3-获取所有容器名称和IP"><span class="nav-number">11.6.3.</span> <span class="nav-text">11.6.3 获取所有容器名称和IP</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-7-Macos的网络问题"><span class="nav-number">11.7.</span> <span class="nav-text">11.7 Macos的网络问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-8-查看端口映射配置"><span class="nav-number">11.8.</span> <span class="nav-text">11.8 查看端口映射配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-Docker工具安装"><span class="nav-number">12.</span> <span class="nav-text">12.Docker工具安装</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#12-1-vim"><span class="nav-number">12.0.1.</span> <span class="nav-text">12.1 vim</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#12-2-ping"><span class="nav-number">12.0.2.</span> <span class="nav-text">12.2 ping</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#12-3-ifconfig"><span class="nav-number">12.0.3.</span> <span class="nav-text">12.3 ifconfig</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#12-4-yum"><span class="nav-number">12.0.4.</span> <span class="nav-text">12.4 yum</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-常用容器"><span class="nav-number">13.</span> <span class="nav-text">13.常用容器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#13-1-Mysql"><span class="nav-number">13.1.</span> <span class="nav-text">13.1 Mysql</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13-2-tomcat"><span class="nav-number">13.2.</span> <span class="nav-text">13.2 tomcat</span></a></li></ol></li></ol></div>
            

            
            
          </div>
        </div>
      <!--/noindex-->
      


    </div>
  </aside>
  
  

  <div id="sidebar-dimmer"></div>
 


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">  <a href="http://www.beian.miit.gov.cn" rel="noopener" target="_blank">粵ICP备19091267号 </a>&copy; 2019 – <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kim.Zhang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">629k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">9:32</span>
</div>


<div class="busuanzi-count">
  <script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      本站总访问量 
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv">4</span>
    </span>
    <span> 次 </span>
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      有 
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv">309</span>
    </span>
    <span> 人看我的博客啦 </span>
  <span class="post-meta-divider">|</span>
  <div class="powered-by"></div>
  <span class="post-count">博客全站共176.7k字</span>
</div>


<div>
<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("08/08/2019 14:00:00");
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>
</div>




  
  

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>

    
  
  <div id="needsharebutton-float">
    <span class="btn">
      <i class="fa fa-share-alt" aria-hidden="true"></i>
    </span>
  </div>
<script src="/lib/needsharebutton/needsharebutton.js"></script>
<script>
    pbOptions = {};
      pbOptions.iconStyle = "box";
    
      pbOptions.boxForm = "horizontal";
    
      pbOptions.position = "bottomCenter";
    
      pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
    
    new needShareButton('#needsharebutton-postbottom', pbOptions);
    flOptions = {};
      flOptions.iconStyle = "box";
    
      flOptions.boxForm = "horizontal";
    
      flOptions.position = "middleRight";
    
      flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
    
    new needShareButton('#needsharebutton-float', flOptions);
</script>


  </div>

  
    
    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>
  <script src="/lib/reading_progress/reading_progress.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>


  <script src="/js/affix.js?v=7.3.0"></script>
  <script src="/js/schemes/pisces.js?v=7.3.0"></script>


<script src="/js/next-boot.js?v=7.3.0"></script>






  


  <script src="/lib/bookmark/bookmark.min.js?v=1.0"></script>
  <script>
  if (CONFIG.page.isPost) {
    bookmark.scrollToMark('auto', "#更多");
  } else {
    bookmark.loadBookmark();
  }
  </script>













  <script src="/js/local-search.js?v=7.3.0"></script>














  

  

  


  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>


</body>
<script type="text/javascript" src="/js/clicklove.js"></script>
</html>
